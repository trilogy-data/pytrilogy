query_id = 32
gen_length = 1602
generated_sql = """

WITH 
cheerful as (
SELECT
    \"catalog_sales\".\"CS_EXT_DISCOUNT_AMT\" as \"discount_amount\",
    \"item_items\".\"I_ITEM_SK\" as \"item_id\",
    \"item_items\".\"I_MANUFACT_ID\" as \"item_manufacturer_id\",
    cast(\"sold_date_date\".\"D_DATE\" as date) as \"sold_date_date\"
FROM
    \"memory\".\"catalog_sales\" as \"catalog_sales\"
    INNER JOIN \"memory\".\"item\" as \"item_items\" on \"catalog_sales\".\"CS_ITEM_SK\" = \"item_items\".\"I_ITEM_SK\"
    INNER JOIN \"memory\".\"date_dim\" as \"sold_date_date\" on \"catalog_sales\".\"CS_SOLD_DATE_SK\" = \"sold_date_date\".\"D_DATE_SK\"
WHERE
    \"item_items\".\"I_MANUFACT_ID\" = 977 and cast(\"sold_date_date\".\"D_DATE\" as date) >= :start_date and cast(\"sold_date_date\".\"D_DATE\" as date) <= :end_date
),
thoughtful as (
SELECT
    \"catalog_sales\".\"CS_ITEM_SK\" as \"item_id\",
    avg(\"catalog_sales\".\"CS_EXT_DISCOUNT_AMT\") as \"_virt_agg_avg_721736882945984\"
FROM
    \"memory\".\"catalog_sales\" as \"catalog_sales\"
    INNER JOIN \"memory\".\"date_dim\" as \"sold_date_date\" on \"catalog_sales\".\"CS_SOLD_DATE_SK\" = \"sold_date_date\".\"D_DATE_SK\"
WHERE
    cast(\"sold_date_date\".\"D_DATE\" as date) >= :start_date and cast(\"sold_date_date\".\"D_DATE\" as date) <= :end_date

GROUP BY 
    \"catalog_sales\".\"CS_ITEM_SK\")
SELECT
    sum(\"cheerful\".\"discount_amount\") as \"total_discount\"
FROM
    \"thoughtful\"
    INNER JOIN \"cheerful\" on \"thoughtful\".\"item_id\" = \"cheerful\".\"item_id\"
WHERE
    \"cheerful\".\"item_manufacturer_id\" = 977 and \"cheerful\".\"sold_date_date\" >= :start_date and \"cheerful\".\"sold_date_date\" <= :end_date and \"cheerful\".\"discount_amount\" > 1.3 * \"thoughtful\".\"_virt_agg_avg_721736882945984\"

LIMIT (100)"""
