query_id = 8
gen_length = 3522
generated_sql = """

WITH 
questionable as (
SELECT
    \"customer_address_customer_address\".\"CA_ZIP\" as \"customer_address_zip\",
    \"customer_customers\".\"C_CUSTOMER_SK\" as \"customer_id\",
    \"customer_customers\".\"C_PREFERRED_CUST_FLAG\" as \"customer_preferred_cust_flag\"
FROM
    \"memory\".\"customer_address\" as \"customer_address_customer_address\"
    INNER JOIN \"memory\".\"customer\" as \"customer_customers\" on \"customer_address_customer_address\".\"CA_ADDRESS_SK\" = \"customer_customers\".\"C_CURRENT_ADDR_SK\"),
cheerful as (
SELECT
    unnest(:_virt_7180871482901048) as \"zips_pre\"
),
abundant as (
SELECT
    \"questionable\".\"customer_address_zip\" as \"customer_address_zip\",
    CASE WHEN \"questionable\".\"customer_preferred_cust_flag\" = 'Y' THEN \"questionable\".\"customer_id\" ELSE NULL END as \"_virt_filter_id_8603331542397217\"
FROM
    \"questionable\"),
uneven as (
SELECT
    \"abundant\".\"customer_address_zip\" as \"customer_address_zip\",
    count(\"abundant\".\"_virt_filter_id_8603331542397217\") as \"zip_p_count\"
FROM
    \"abundant\"
GROUP BY 
    \"abundant\".\"customer_address_zip\"),
yummy as (
SELECT
    \"customer_address_customer_address\".\"CA_ZIP\" as \"customer_address_zip\",
    \"uneven\".\"zip_p_count\" as \"zip_p_count\"
FROM
    \"uneven\"
    INNER JOIN \"memory\".\"customer_address\" as \"customer_address_customer_address\" on \"uneven\".\"customer_address_zip\" = \"customer_address_customer_address\".\"CA_ZIP\"),
juicy as (
SELECT
    CASE WHEN \"yummy\".\"zip_p_count\" > 10 THEN \"yummy\".\"customer_address_zip\" ELSE NULL END as \"p_cust_zip\"
FROM
    \"yummy\"),
vacuous as (
SELECT
    SUBSTRING(\"juicy\".\"p_cust_zip\",1,5) as \"_virt_func_substring_4293448550966409\"
FROM
    \"juicy\"
GROUP BY 
    \"juicy\".\"p_cust_zip\",
    SUBSTRING(\"juicy\".\"p_cust_zip\",1,5)),
concerned as (
SELECT
    \"vacuous\".\"_virt_func_substring_4293448550966409\" as \"_virt_func_substring_4293448550966409\"
FROM
    \"vacuous\"
GROUP BY 
    \"vacuous\".\"_virt_func_substring_4293448550966409\"),
young as (
SELECT
    SUBSTRING(cast(\"cheerful\".\"zips_pre\" as string),1,5) as \"_virt_filter_zips_9007816554154539\"
FROM
    \"cheerful\"
WHERE
    SUBSTRING(cast(\"cheerful\".\"zips_pre\" as string),1,5) in (select concerned.\"_virt_func_substring_4293448550966409\" from concerned where concerned.\"_virt_func_substring_4293448550966409\" is not null)
),
sparkling as (
SELECT
    SUBSTRING(\"young\".\"_virt_filter_zips_9007816554154539\",1,2) as \"final_zips\"
FROM
    \"young\"
GROUP BY 
    \"young\".\"_virt_filter_zips_9007816554154539\",
    SUBSTRING(\"young\".\"_virt_filter_zips_9007816554154539\",1,2)),
abhorrent as (
SELECT
    \"sparkling\".\"final_zips\" as \"final_zips\"
FROM
    \"sparkling\"
GROUP BY 
    \"sparkling\".\"final_zips\")
SELECT
    \"store_sales_store_store\".\"S_STORE_NAME\" as \"store_sales_store_name\",
    sum(\"store_sales_store_sales\".\"SS_NET_PROFIT\") as \"store_net_profit\"
FROM
    \"memory\".\"store_sales\" as \"store_sales_store_sales\"
    INNER JOIN \"memory\".\"date_dim\" as \"store_sales_date_date\" on \"store_sales_store_sales\".\"SS_SOLD_DATE_SK\" = \"store_sales_date_date\".\"D_DATE_SK\"
    INNER JOIN \"memory\".\"store\" as \"store_sales_store_store\" on \"store_sales_store_sales\".\"SS_STORE_SK\" = \"store_sales_store_store\".\"S_STORE_SK\"
WHERE
    \"store_sales_date_date\".\"D_QOY\" = 2 and cast(\"store_sales_date_date\".\"D_YEAR\" as int) = 1998 and SUBSTRING(\"store_sales_store_store\".\"S_ZIP\",1,2) in (select abhorrent.\"final_zips\" from abhorrent where abhorrent.\"final_zips\" is not null)

GROUP BY 
    \"store_sales_store_store\".\"S_STORE_NAME\"
ORDER BY 
    \"store_sales_store_store\".\"S_STORE_NAME\" asc
LIMIT (100)"""
