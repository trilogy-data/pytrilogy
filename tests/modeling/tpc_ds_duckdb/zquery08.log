query_id = 8
gen_length = 2926
generated_sql = """

WITH 
questionable as (
SELECT
    \"customer_address_customer_address\".\"CA_ZIP\" as \"customer_address_zip\",
    count(CASE WHEN \"customer_customers\".\"C_PREFERRED_CUST_FLAG\" = 'Y' THEN \"customer_customers\".\"C_CUSTOMER_SK\" ELSE NULL END) as \"zip_p_count\"
FROM
    \"memory\".\"customer_address\" as \"customer_address_customer_address\"
    INNER JOIN \"memory\".\"customer\" as \"customer_customers\" on \"customer_address_customer_address\".\"CA_ADDRESS_SK\" = \"customer_customers\".\"C_CURRENT_ADDR_SK\"
GROUP BY 
    \"customer_address_customer_address\".\"CA_ZIP\"),
cheerful as (
SELECT
    unnest(:_virt_7180871482901048) as \"zips_pre\"
),
yummy as (
SELECT
    SUBSTRING(CASE WHEN \"questionable\".\"zip_p_count\" > 10 THEN \"customer_address_customer_address\".\"CA_ZIP\" ELSE NULL END,1,5) as \"_virt_func_substring_4293448550966409\"
FROM
    \"questionable\"
    INNER JOIN \"memory\".\"customer_address\" as \"customer_address_customer_address\" on \"questionable\".\"customer_address_zip\" = \"customer_address_customer_address\".\"CA_ZIP\"
GROUP BY 
    CASE WHEN \"questionable\".\"zip_p_count\" > 10 THEN \"customer_address_customer_address\".\"CA_ZIP\" ELSE NULL END,
    SUBSTRING(CASE WHEN \"questionable\".\"zip_p_count\" > 10 THEN \"customer_address_customer_address\".\"CA_ZIP\" ELSE NULL END,1,5)),
concerned as (
SELECT
    \"yummy\".\"_virt_func_substring_4293448550966409\" as \"_virt_func_substring_4293448550966409\"
FROM
    \"yummy\"
GROUP BY 
    \"yummy\".\"_virt_func_substring_4293448550966409\"),
young as (
SELECT
    SUBSTRING(SUBSTRING(cast(\"cheerful\".\"zips_pre\" as string),1,5),1,2) as \"final_zips\"
FROM
    \"cheerful\"
WHERE
    SUBSTRING(cast(\"cheerful\".\"zips_pre\" as string),1,5) in (select concerned.\"_virt_func_substring_4293448550966409\" from concerned where concerned.\"_virt_func_substring_4293448550966409\" is not null)

GROUP BY 
    SUBSTRING(SUBSTRING(cast(\"cheerful\".\"zips_pre\" as string),1,5),1,2),
    SUBSTRING(cast(\"cheerful\".\"zips_pre\" as string),1,5)),
abhorrent as (
SELECT
    \"young\".\"final_zips\" as \"final_zips\"
FROM
    \"young\"
GROUP BY 
    \"young\".\"final_zips\")
SELECT
    \"store_sales_store_store\".\"S_STORE_NAME\" as \"store_sales_store_name\",
    sum(\"store_sales_store_sales\".\"SS_NET_PROFIT\") as \"store_net_profit\"
FROM
    \"memory\".\"store_sales\" as \"store_sales_store_sales\"
    INNER JOIN \"memory\".\"date_dim\" as \"store_sales_date_date\" on \"store_sales_store_sales\".\"SS_SOLD_DATE_SK\" = \"store_sales_date_date\".\"D_DATE_SK\"
    INNER JOIN \"memory\".\"store\" as \"store_sales_store_store\" on \"store_sales_store_sales\".\"SS_STORE_SK\" = \"store_sales_store_store\".\"S_STORE_SK\"
WHERE
    \"store_sales_date_date\".\"D_QOY\" = 2 and cast(\"store_sales_date_date\".\"D_YEAR\" as int) = 1998 and SUBSTRING(\"store_sales_store_store\".\"S_ZIP\",1,2) in (select abhorrent.\"final_zips\" from abhorrent where abhorrent.\"final_zips\" is not null)

GROUP BY 
    \"store_sales_store_store\".\"S_STORE_NAME\"
ORDER BY 
    \"store_sales_store_store\".\"S_STORE_NAME\" asc
LIMIT (100)"""
