query_id = 24
gen_length = 7355
generated_sql = """

WITH 
questionable as (
SELECT
    store_sales_customer_customers.\"C_CUSTOMER_SK\" as \"store_sales_customer_id\",
    store_sales_customer_customers.\"C_FIRST_NAME\" as \"store_sales_customer_first_name\",
    store_sales_customer_customers.\"C_LAST_NAME\" as \"store_sales_customer_last_name\",
    store_sales_store_sales.\"SS_ITEM_SK\" as \"store_sales_item_id\",
    store_sales_store_sales.\"SS_NET_PAID\" as \"store_sales_net_paid\",
    store_sales_store_sales.\"SS_TICKET_NUMBER\" as \"store_sales_ticket_number\",
    store_sales_store_store.\"S_STORE_NAME\" as \"store_sales_store_name\",
    store_sales_store_store.\"S_STORE_SK\" as \"store_sales_store_id\"
FROM
    memory.store_sales as store_sales_store_sales
    LEFT OUTER JOIN memory.store_returns as store_sales_store_returns on store_sales_store_sales.\"SS_ITEM_SK\" = store_sales_store_returns.\"SR_ITEM_SK\" AND store_sales_store_sales.\"SS_TICKET_NUMBER\" = store_sales_store_returns.\"SR_TICKET_NUMBER\"
    INNER JOIN memory.store as store_sales_store_store on store_sales_store_sales.\"SS_STORE_SK\" = store_sales_store_store.\"S_STORE_SK\"
    INNER JOIN memory.customer as store_sales_customer_customers on store_sales_store_sales.\"SS_CUSTOMER_SK\" = store_sales_customer_customers.\"C_CUSTOMER_SK\"
    INNER JOIN memory.customer_address as store_sales_customer_customer_address on store_sales_customer_customers.\"C_CURRENT_ADDR_SK\" = store_sales_customer_customer_address.\"CA_ADDRESS_SK\"
WHERE
    store_sales_store_store.\"S_MARKET_ID\" = 8 and store_sales_customer_customers.\"C_BIRTH_COUNTRY\" != UPPER(store_sales_customer_customer_address.\"CA_COUNTRY\")  and CASE WHEN store_sales_store_returns.\"SR_RETURN_TIME_SK\" THEN TRUE ELSE FALSE END is True and store_sales_store_store.\"S_ZIP\" = store_sales_customer_customer_address.\"CA_ZIP\"
),
vacuous as (
SELECT
    store_sales_item_items.\"I_COLOR\" as \"store_sales_item_color\",
    store_sales_item_items.\"I_ITEM_SK\" as \"store_sales_item_id\"
FROM
    memory.store_sales as store_sales_store_sales
    INNER JOIN memory.store as store_sales_store_store on store_sales_store_sales.\"SS_STORE_SK\" = store_sales_store_store.\"S_STORE_SK\"
    INNER JOIN memory.customer as store_sales_customer_customers on store_sales_store_sales.\"SS_CUSTOMER_SK\" = store_sales_customer_customers.\"C_CUSTOMER_SK\"
    LEFT OUTER JOIN memory.store_returns as store_sales_store_returns on store_sales_store_sales.\"SS_ITEM_SK\" = store_sales_store_returns.\"SR_ITEM_SK\" AND store_sales_store_sales.\"SS_TICKET_NUMBER\" = store_sales_store_returns.\"SR_TICKET_NUMBER\"
    INNER JOIN memory.customer_address as store_sales_customer_customer_address on store_sales_customer_customers.\"C_CURRENT_ADDR_SK\" = store_sales_customer_customer_address.\"CA_ADDRESS_SK\"
    INNER JOIN memory.item as store_sales_item_items on store_sales_store_sales.\"SS_ITEM_SK\" = store_sales_item_items.\"I_ITEM_SK\"
WHERE
    store_sales_store_store.\"S_MARKET_ID\" = 8 and store_sales_customer_customers.\"C_BIRTH_COUNTRY\" != UPPER(store_sales_customer_customer_address.\"CA_COUNTRY\")  and CASE WHEN store_sales_store_returns.\"SR_RETURN_TIME_SK\" THEN TRUE ELSE FALSE END is True and store_sales_store_store.\"S_ZIP\" = store_sales_customer_customer_address.\"CA_ZIP\"
),
quizzical as (
SELECT
    :__preql_internal_all_rows as \"__preql_internal_all_rows\"
),
yummy as (
SELECT
    questionable.\"store_sales_store_id\" as \"store_sales_store_id\",
    questionable.\"store_sales_store_name\" as \"store_sales_store_name\"
FROM
    questionable
GROUP BY 
    questionable.\"store_sales_store_id\",
    questionable.\"store_sales_store_name\"),
uneven as (
SELECT
    questionable.\"store_sales_customer_first_name\" as \"store_sales_customer_first_name\",
    questionable.\"store_sales_customer_id\" as \"store_sales_customer_id\",
    questionable.\"store_sales_customer_last_name\" as \"store_sales_customer_last_name\"
FROM
    questionable
GROUP BY 
    questionable.\"store_sales_customer_first_name\",
    questionable.\"store_sales_customer_id\",
    questionable.\"store_sales_customer_last_name\"),
abundant as (
SELECT
    questionable.\"store_sales_customer_id\" as \"store_sales_customer_id\",
    questionable.\"store_sales_item_id\" as \"store_sales_item_id\",
    questionable.\"store_sales_store_id\" as \"store_sales_store_id\",
    sum(questionable.\"store_sales_net_paid\") as \"net_paid\"
FROM
    questionable
GROUP BY 
    questionable.\"store_sales_customer_id\",
    questionable.\"store_sales_item_id\",
    questionable.\"store_sales_store_id\"),
concerned as (
SELECT
    vacuous.\"store_sales_item_color\" as \"store_sales_item_color\",
    vacuous.\"store_sales_item_id\" as \"store_sales_item_id\"
FROM
    vacuous
GROUP BY 
    vacuous.\"store_sales_item_color\",
    vacuous.\"store_sales_item_id\"),
young as (
SELECT
    abundant.\"net_paid\" as \"su_net_paid\",
    concerned.\"store_sales_item_color\" as \"su_store_sales_item_color\",
    uneven.\"store_sales_customer_first_name\" as \"su_store_sales_customer_first_name\",
    uneven.\"store_sales_customer_last_name\" as \"su_store_sales_customer_last_name\",
    yummy.\"store_sales_store_name\" as \"su_store_sales_store_name\"
FROM
    abundant
    INNER JOIN concerned on abundant.\"store_sales_item_id\" = concerned.\"store_sales_item_id\"
    INNER JOIN yummy on abundant.\"store_sales_store_id\" = yummy.\"store_sales_store_id\"
    INNER JOIN uneven on abundant.\"store_sales_customer_id\" = uneven.\"store_sales_customer_id\"
GROUP BY 
    abundant.\"net_paid\",
    abundant.\"store_sales_customer_id\",
    abundant.\"store_sales_item_id\",
    abundant.\"store_sales_store_id\",
    concerned.\"store_sales_item_color\",
    uneven.\"store_sales_customer_first_name\",
    uneven.\"store_sales_customer_last_name\",
    yummy.\"store_sales_store_name\"),
sweltering as (
SELECT
    CASE WHEN young.\"su_store_sales_item_color\" = 'peach' THEN young.\"su_net_paid\" ELSE NULL END as \"_virt_filter_net_paid_3139932349044856\",
    young.\"su_net_paid\" as \"su_net_paid\",
    young.\"su_store_sales_customer_first_name\" as \"su_store_sales_customer_first_name\",
    young.\"su_store_sales_customer_last_name\" as \"su_store_sales_customer_last_name\",
    young.\"su_store_sales_store_name\" as \"su_store_sales_store_name\"
FROM
    young),
sparkling as (
SELECT
    quizzical.\"__preql_internal_all_rows\" as \"__preql_internal_all_rows\",
    young.\"su_net_paid\" as \"su_net_paid\"
FROM
    young
    FULL JOIN quizzical on 1=1),
late as (
SELECT
    sum(sweltering.\"_virt_filter_net_paid_3139932349044856\") as \"peach_sales\",
    sweltering.\"su_store_sales_customer_first_name\" as \"su_store_sales_customer_first_name\",
    sweltering.\"su_store_sales_customer_last_name\" as \"su_store_sales_customer_last_name\",
    sweltering.\"su_store_sales_store_name\" as \"su_store_sales_store_name\"
FROM
    sweltering
GROUP BY 
    sweltering.\"su_store_sales_customer_first_name\",
    sweltering.\"su_store_sales_customer_last_name\",
    sweltering.\"su_store_sales_store_name\"),
abhorrent as (
SELECT
    avg(sparkling.\"su_net_paid\") as \"avg_store_customer_sales\"
FROM
    sparkling)
SELECT
    late.\"su_store_sales_customer_last_name\" as \"su_store_sales_customer_last_name\",
    late.\"su_store_sales_customer_first_name\" as \"su_store_sales_customer_first_name\",
    late.\"su_store_sales_store_name\" as \"su_store_sales_store_name\",
    late.\"peach_sales\" as \"peach_sales\"
FROM
    late
    FULL JOIN abhorrent on 1=1
WHERE
    late.\"peach_sales\" > 0.05 * abhorrent.\"avg_store_customer_sales\"
"""
