query_id = 24
parse_time = 8.785871
exec_time = 0.483835
comp_time = 0.564431
gen_length = 37684
generated_sql = """

WITH 
elated as (
-- Target: Grain<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>. Group: False Source: SourceType.MERGE.
-- Joins: left outer JOIN store_sales and store_returns on store_sales.item.id<store_sales.item.id>=store_sales.item.id<store_sales.item.id>[],store_sales.ticket_number<store_sales.ticket_number>=store_sales.ticket_number<store_sales.ticket_number>[], inner JOIN store_sales and customers on store_sales.customer.id<store_sales.customer.id>=store_sales.customer.id<store_sales.customer.id>[], inner JOIN store_sales and items on store_sales.item.id<store_sales.item.id>=store_sales.item.id<store_sales.item.id>[], inner JOIN store_sales and store on store_sales.store.id<store_sales.store.id>=store_sales.store.id<store_sales.store.id>[], left outer JOIN customers and customer_address on store_sales.customer.address_id<store_sales.customer.address_id>=store_sales.customer.address_id<store_sales.customer.address_id>[].
-- Source Map: {'store_sales.item.size': ['items'], 'store_sales.item.current_price': ['items'], 'store_sales.item.units': ['items'], 'store_sales.item.color': ['items'], 'store_sales.item.id': ['items'], 'store_sales.item.manager_id': ['items'], 'store_sales.customer.birth_country': ['customers'], 'store_sales.customer.id': ['customers'], 'store_sales.customer.last_name': ['customers'], 'store_sales.customer.address_id': ['customers'], 'store_sales.customer.first_name': ['customers'], 'store_sales.customer.state': ['customer_address'], 'store_sales.customer.zip': ['customer_address'], 'store_sales.customer.country': ['customer_address'], 'store_sales.store.zip': ['store'], 'store_sales.store.market': ['store'], 'store_sales.store.id': ['store'], 'store_sales.store.name': ['store'], 'store_sales.store.state': ['store'], 'store_sales.net_paid': ['store_sales'], 'store_sales.ticket_number': ['store_sales'], 'store_sales.is_returned': ['store_returns'], 'store_sales.item.brand_id': ['items'], 'store_sales.item.category': ['items'], 'store_sales.item.desc': ['items'], 'store_sales.item.brand_name': ['items'], 'store_sales.item.manufacturer_id': ['items'], 'store_sales.item.name': ['items'], 'store_sales.item.class': ['items'], 'store_sales.customer.text_id': ['customers'], 'store_sales.customer.preferred_cust_flag': ['customers'], 'store_sales.customer.demographics.id': ['customers'], 'store_sales.customer.street': ['customer_address'], 'store_sales.customer.county': ['customer_address'], 'store_sales.customer.city': ['customer_address'], 'store_sales.store.text_id': ['store'], 'store_sales.store.date.id': ['store'], 'store_sales.store.store_manager': ['store'], 'store_sales.store.market_id': ['store'], 'store_sales.store.market_manager': ['store'], 'store_sales.store.city': ['store'], 'store_sales.store.employees': ['store'], 'store_sales.store.county': ['store'], 'store_sales.store.hours': ['store'], 'store_sales.store.tax_percentage': ['store'], 'store_sales.store.geography_class': ['store'], 'store_sales.store.floor_space': ['store'], 'store_sales.time.id': ['store_sales'], 'store_sales.ext_discount_amount': ['store_sales'], 'store_sales.date.id': ['store_sales'], 'store_sales.promotion.id': ['store_sales'], 'store_sales.quantity': ['store_sales'], 'store_sales.coupon_amt': ['store_sales'], 'store_sales.customer_demographic.id': ['store_sales'], 'store_sales.list_price': ['store_sales'], 'store_sales.ext_wholesale_cost': ['store_sales'], 'store_sales.sales_price': ['store_sales'], 'store_sales.ext_list_price': ['store_sales'], 'store_sales.net_profit': ['store_sales'], 'store_sales.ext_sales_price': ['store_sales'], 'store_sales.return_time.id': ['store_returns'], 'store_sales.return_amount': ['store_returns'], 'store_sales.return_date.id': ['store_returns']}.
-- Output: store_sales.net_paid<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>, store_sales.store.market<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>, store_sales.customer.birth_country<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>, store_sales.customer.country<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>, store_sales.is_returned<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>, store_sales.store.zip<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>, store_sales.customer.zip<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>, store_sales.item.color<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>, store_sales.item.current_price<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>, store_sales.customer.first_name<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>, store_sales.customer.last_name<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>, store_sales.item.manager_id<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>, store_sales.store.name<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>, store_sales.item.size<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>, store_sales.customer.state<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>, store_sales.store.state<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>, store_sales.item.units<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>, store_sales.ticket_number<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>, store_sales.item.id<store_sales.customer.address_id,store_sales.item.id,store_sales.customer.id,store_sales.store.id,store_sales.ticket_number>.
SELECT
    store_sales.\"SS_NET_PAID\" as \"store_sales_net_paid\",
    store.\"S_MARKET_ID\" as \"store_sales_store_market\",
    customers.\"C_BIRTH_COUNTRY\" as \"store_sales_customer_birth_country\",
    customer_address.\"CA_COUNTRY\" as \"store_sales_customer_country\",
    CASE WHEN store_returns.\"SR_RETURN_TIME_SK\" THEN TRUE ELSE FALSE END as \"store_sales_is_returned\",
    store.\"S_ZIP\" as \"store_sales_store_zip\",
    customer_address.\"CA_ZIP\" as \"store_sales_customer_zip\",
    items.\"I_COLOR\" as \"store_sales_item_color\",
    items.\"I_CURRENT_PRICE\" as \"store_sales_item_current_price\",
    customers.\"C_FIRST_NAME\" as \"store_sales_customer_first_name\",
    customers.\"C_LAST_NAME\" as \"store_sales_customer_last_name\",
    items.\"I_MANAGER_ID\" as \"store_sales_item_manager_id\",
    store.\"S_STORE_NAME\" as \"store_sales_store_name\",
    items.\"I_SIZE\" as \"store_sales_item_size\",
    customer_address.\"CA_STATE\" as \"store_sales_customer_state\",
    store.\"S_STATE\" as \"store_sales_store_state\",
    items.\"I_UNITS\" as \"store_sales_item_units\",
    store_sales.\"SS_TICKET_NUMBER\" as \"store_sales_ticket_number\",
    items.\"I_ITEM_SK\" as \"store_sales_item_id\"
FROM
    memory.store_sales as store_sales
    LEFT OUTER JOIN memory.store_returns as store_returns on store_sales.\"SS_ITEM_SK\" = store_returns.\"SR_ITEM_SK\" AND store_sales.\"SS_TICKET_NUMBER\" = store_returns.\"SR_TICKET_NUMBER\"
    INNER JOIN memory.customer as customers on store_sales.\"SS_CUSTOMER_SK\" = customers.\"C_CUSTOMER_SK\"
    INNER JOIN memory.item as items on store_sales.\"SS_ITEM_SK\" = items.\"I_ITEM_SK\"
    INNER JOIN memory.store as store on store_sales.\"SS_STORE_SK\" = store.\"S_STORE_SK\"
    LEFT OUTER JOIN memory.customer_address as customer_address on customers.\"C_CURRENT_ADDR_SK\" = customer_address.\"CA_ADDRESS_SK\"
WHERE
    store.\"S_MARKET_ID\" = 8 and customers.\"C_BIRTH_COUNTRY\" != UPPER(customer_address.\"CA_COUNTRY\")  and CASE WHEN store_returns.\"SR_RETURN_TIME_SK\" THEN TRUE ELSE FALSE END is True and store.\"S_ZIP\" = customer_address.\"CA_ZIP\"
),
faithful as (
-- Target: Grain<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>. Group: True Source: SourceType.GROUP. References: elated.
-- Source Map: {'store_sales.net_paid': ['elated'], 'store_sales.store.market': ['elated'], 'store_sales.customer.birth_country': ['elated'], 'store_sales.customer.country': ['elated'], 'store_sales.is_returned': ['elated'], 'store_sales.store.zip': ['elated'], 'store_sales.customer.zip': ['elated'], 'store_sales.item.color': ['elated'], 'store_sales.item.current_price': ['elated'], 'store_sales.customer.first_name': ['elated'], 'store_sales.customer.last_name': ['elated'], 'store_sales.item.manager_id': ['elated'], 'store_sales.store.name': ['elated'], 'store_sales.item.size': ['elated'], 'store_sales.customer.state': ['elated'], 'store_sales.store.state': ['elated'], 'store_sales.item.units': ['elated'], 'store_sales.ticket_number': ['elated'], 'store_sales.item.id': ['elated'], 'local.net_paid': [], 'su.store_sales.customer.first_name': [], 'su.store_sales.customer.last_name': [], 'su.store_sales.customer.state': [], 'su.store_sales.store.state': [], 'su.store_sales.store.name': [], 'su.store_sales.item.color': [], 'su.store_sales.item.current_price': [], 'su.store_sales.item.manager_id': [], 'su.store_sales.item.units': [], 'su.store_sales.item.size': [], 'su.net_paid': []}.
-- Output: local.net_paid<store_sales.item.color,store_sales.item.current_price,store_sales.customer.first_name,store_sales.customer.last_name,store_sales.item.manager_id,store_sales.store.name,store_sales.item.size,store_sales.customer.state,store_sales.store.state,store_sales.item.units>, store_sales.item.color<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, store_sales.item.current_price<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, store_sales.customer.first_name<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, store_sales.customer.last_name<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, store_sales.item.manager_id<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, store_sales.store.name<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, store_sales.item.size<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, store_sales.customer.state<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, store_sales.store.state<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, store_sales.item.units<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, su.store_sales.customer.first_name<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, su.store_sales.customer.last_name<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, su.store_sales.customer.state<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, su.store_sales.store.state<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, su.store_sales.store.name<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, su.store_sales.item.color<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, su.store_sales.item.current_price<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, su.store_sales.item.manager_id<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, su.store_sales.item.units<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, su.store_sales.item.size<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, su.net_paid<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>.
-- Hidden: local.net_paid<store_sales.item.color,store_sales.item.current_price,store_sales.customer.first_name,store_sales.customer.last_name,store_sales.item.manager_id,store_sales.store.name,store_sales.item.size,store_sales.customer.state,store_sales.store.state,store_sales.item.units>, store_sales.item.color<store_sales.item.id>, store_sales.item.current_price<store_sales.item.id>, store_sales.customer.first_name<store_sales.customer.id>, store_sales.customer.last_name<store_sales.customer.id>, store_sales.item.manager_id<store_sales.item.id>, store_sales.store.name<store_sales.store.id>, store_sales.item.size<store_sales.item.id>, store_sales.customer.state<store_sales.customer.address_id>, store_sales.store.state<store_sales.store.id>, store_sales.item.units<store_sales.item.id>.
-- Nullable: local.net_paid<store_sales.item.color,store_sales.item.current_price,store_sales.customer.first_name,store_sales.customer.last_name,store_sales.item.manager_id,store_sales.store.name,store_sales.item.size,store_sales.customer.state,store_sales.store.state,store_sales.item.units>, su.store_sales.customer.first_name<su.store_sales.item.color,su.store_sales.item.current_price,su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.item.manager_id,su.store_sales.store.name,su.net_paid,su.store_sales.item.size,su.store_sales.customer.state,su.store_sales.store.state,su.store_sales.item.units>, su.store_sales.customer.last_name<su.store_sales.item.color,su.store_sales.item.current_price,su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.item.manager_id,su.store_sales.store.name,su.net_paid,su.store_sales.item.size,su.store_sales.customer.state,su.store_sales.store.state,su.store_sales.item.units>, su.store_sales.customer.state<su.store_sales.item.color,su.store_sales.item.current_price,su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.item.manager_id,su.store_sales.store.name,su.net_paid,su.store_sales.item.size,su.store_sales.customer.state,su.store_sales.store.state,su.store_sales.item.units>, su.store_sales.store.state<su.store_sales.item.color,su.store_sales.item.current_price,su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.item.manager_id,su.store_sales.store.name,su.net_paid,su.store_sales.item.size,su.store_sales.customer.state,su.store_sales.store.state,su.store_sales.item.units>, su.store_sales.store.name<su.store_sales.item.color,su.store_sales.item.current_price,su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.item.manager_id,su.store_sales.store.name,su.net_paid,su.store_sales.item.size,su.store_sales.customer.state,su.store_sales.store.state,su.store_sales.item.units>, su.store_sales.item.color<su.store_sales.item.color,su.store_sales.item.current_price,su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.item.manager_id,su.store_sales.store.name,su.net_paid,su.store_sales.item.size,su.store_sales.customer.state,su.store_sales.store.state,su.store_sales.item.units>, su.store_sales.item.current_price<su.store_sales.item.color,su.store_sales.item.current_price,su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.item.manager_id,su.store_sales.store.name,su.net_paid,su.store_sales.item.size,su.store_sales.customer.state,su.store_sales.store.state,su.store_sales.item.units>, su.store_sales.item.manager_id<su.store_sales.item.color,su.store_sales.item.current_price,su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.item.manager_id,su.store_sales.store.name,su.net_paid,su.store_sales.item.size,su.store_sales.customer.state,su.store_sales.store.state,su.store_sales.item.units>, su.store_sales.item.units<su.store_sales.item.color,su.store_sales.item.current_price,su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.item.manager_id,su.store_sales.store.name,su.net_paid,su.store_sales.item.size,su.store_sales.customer.state,su.store_sales.store.state,su.store_sales.item.units>, su.store_sales.item.size<su.store_sales.item.color,su.store_sales.item.current_price,su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.item.manager_id,su.store_sales.store.name,su.net_paid,su.store_sales.item.size,su.store_sales.customer.state,su.store_sales.store.state,su.store_sales.item.units>, su.net_paid<su.store_sales.item.color,su.store_sales.item.current_price,su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.item.manager_id,su.store_sales.store.name,su.store_sales.item.size,su.store_sales.customer.state,su.store_sales.store.state,su.store_sales.item.units>.
SELECT
    elated.\"store_sales_customer_first_name\" as \"su_store_sales_customer_first_name\",
    elated.\"store_sales_customer_last_name\" as \"su_store_sales_customer_last_name\",
    elated.\"store_sales_customer_state\" as \"su_store_sales_customer_state\",
    elated.\"store_sales_store_state\" as \"su_store_sales_store_state\",
    elated.\"store_sales_store_name\" as \"su_store_sales_store_name\",
    elated.\"store_sales_item_color\" as \"su_store_sales_item_color\",
    elated.\"store_sales_item_current_price\" as \"su_store_sales_item_current_price\",
    elated.\"store_sales_item_manager_id\" as \"su_store_sales_item_manager_id\",
    elated.\"store_sales_item_units\" as \"su_store_sales_item_units\",
    elated.\"store_sales_item_size\" as \"su_store_sales_item_size\",
    sum(elated.\"store_sales_net_paid\") as \"su_net_paid\"
FROM
    elated
GROUP BY 
    elated.\"store_sales_customer_first_name\",
    elated.\"store_sales_item_color\",
    elated.\"store_sales_item_manager_id\",
    elated.\"store_sales_store_name\",
    elated.\"store_sales_item_current_price\",
    elated.\"store_sales_customer_state\",
    elated.\"store_sales_customer_last_name\",
    elated.\"store_sales_store_state\",
    elated.\"store_sales_item_size\",
    elated.\"store_sales_item_units\"),
imported as (
-- Target: Grain<su.store_sales.item.color,su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.store.name,su.net_paid>. Group: False Source: SourceType.FILTER. References: faithful.
-- Source Map: {'su.store_sales.customer.first_name': ['faithful'], 'su.store_sales.customer.last_name': ['faithful'], 'su.store_sales.customer.state': ['faithful'], 'su.store_sales.store.state': ['faithful'], 'su.store_sales.store.name': ['faithful'], 'su.store_sales.item.color': ['faithful'], 'su.store_sales.item.current_price': ['faithful'], 'su.store_sales.item.manager_id': ['faithful'], 'su.store_sales.item.units': ['faithful'], 'su.store_sales.item.size': ['faithful'], 'su.net_paid': ['faithful'], 'local._virtual_5818638680298942': []}.
-- Output: local._virtual_5818638680298942<su.store_sales.item.color,su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.store.name,su.net_paid>, su.net_paid<su.store_sales.item.color,su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.store.name,su.net_paid>, su.store_sales.customer.first_name<su.store_sales.item.color,su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.store.name,su.net_paid>, su.store_sales.customer.last_name<su.store_sales.item.color,su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.store.name,su.net_paid>, su.store_sales.store.name<su.store_sales.item.color,su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.store.name,su.net_paid>.
SELECT
    CASE WHEN faithful.\"su_store_sales_item_color\" = 'peach' THEN faithful.\"su_net_paid\" ELSE NULL END as \"_virtual_5818638680298942\",
    faithful.\"su_net_paid\" as \"su_net_paid\",
    faithful.\"su_store_sales_customer_first_name\" as \"su_store_sales_customer_first_name\",
    faithful.\"su_store_sales_customer_last_name\" as \"su_store_sales_customer_last_name\",
    faithful.\"su_store_sales_store_name\" as \"su_store_sales_store_name\"
FROM
    faithful),
toucan as (
-- Target: Grain<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>. Group: False Source: SourceType.MERGE. References: faithful.
-- Source Map: {'su.store_sales.customer.first_name': ['faithful'], 'su.store_sales.customer.last_name': ['faithful'], 'su.store_sales.customer.state': ['faithful'], 'su.store_sales.store.state': ['faithful'], 'su.store_sales.store.name': ['faithful'], 'su.store_sales.item.color': ['faithful'], 'su.store_sales.item.current_price': ['faithful'], 'su.store_sales.item.manager_id': ['faithful'], 'su.store_sales.item.units': ['faithful'], 'su.store_sales.item.size': ['faithful'], 'su.net_paid': ['faithful']}.
-- Output: su.net_paid<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>, __preql_internal.all_rows<store_sales.item.color,su.store_sales.item.color,store_sales.item.current_price,su.store_sales.item.current_price,store_sales.customer.first_name,su.store_sales.customer.first_name,store_sales.customer.last_name,su.store_sales.customer.last_name,store_sales.item.manager_id,su.store_sales.item.manager_id,store_sales.store.name,su.store_sales.store.name,store_sales.item.size,su.store_sales.item.size,store_sales.customer.state,store_sales.store.state,su.store_sales.customer.state,su.store_sales.store.state,store_sales.item.units,su.store_sales.item.units>.
-- Nullable: su.net_paid<su.store_sales.item.color,su.store_sales.item.current_price,su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.item.manager_id,su.store_sales.store.name,su.store_sales.item.size,su.store_sales.customer.state,su.store_sales.store.state,su.store_sales.item.units>.
SELECT
    faithful.\"su_net_paid\" as \"su_net_paid\",
    1 as \"__preql_internal_all_rows\"
FROM
    faithful),
cloudy as (
-- Target: Grain<su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.store.name>. Group: True Source: SourceType.GROUP. References: imported.
-- Source Map: {'local._virtual_5818638680298942': ['imported'], 'su.net_paid': ['imported'], 'su.store_sales.customer.first_name': ['imported'], 'su.store_sales.customer.last_name': ['imported'], 'su.store_sales.store.name': ['imported'], 'local.peach_sales': []}.
-- Output: local.peach_sales<su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.store.name>, su.store_sales.customer.first_name<su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.store.name>, su.store_sales.customer.last_name<su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.store.name>, su.store_sales.store.name<su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.store.name>.
-- Nullable: local.peach_sales<su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.store.name>.
SELECT
    sum(imported.\"_virtual_5818638680298942\") as \"peach_sales\",
    imported.\"su_store_sales_customer_first_name\" as \"su_store_sales_customer_first_name\",
    imported.\"su_store_sales_customer_last_name\" as \"su_store_sales_customer_last_name\",
    imported.\"su_store_sales_store_name\" as \"su_store_sales_store_name\"
FROM
    imported
GROUP BY 
    imported.\"su_store_sales_customer_first_name\",
    imported.\"su_store_sales_customer_last_name\",
    imported.\"su_store_sales_store_name\"),
sparrow as (
-- Target: Grain<Abstract>. Group: True Source: SourceType.GROUP. References: toucan.
-- Source Map: {'su.net_paid': ['toucan'], 'local.avg_store_customer_sales': []}.
-- Output: local.avg_store_customer_sales<__preql_internal.all_rows>.
-- Nullable: local.avg_store_customer_sales<__preql_internal.all_rows>.
SELECT
    avg(toucan.\"su_net_paid\") as \"avg_store_customer_sales\"
FROM
    toucan)
-- Target: Grain<su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.store.name>. Group: False Source: SourceType.MERGE. References: sparrow, cloudy.
-- Joins: full JOIN cloudy and sparrow on .
-- Source Map: {'local.avg_store_customer_sales': ['sparrow'], 'local.peach_sales': ['cloudy'], 'su.store_sales.customer.first_name': ['cloudy'], 'su.store_sales.customer.last_name': ['cloudy'], 'su.store_sales.store.name': ['cloudy']}.
-- Output: su.store_sales.customer.last_name<su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.store.name>, su.store_sales.customer.first_name<su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.store.name>, su.store_sales.store.name<su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.store.name>, local.peach_sales<su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.store.name>.
-- Hidden: local.avg_store_customer_sales<__preql_internal.all_rows>.
-- Nullable: local.avg_store_customer_sales<__preql_internal.all_rows>, local.peach_sales<su.store_sales.customer.first_name,su.store_sales.customer.last_name,su.store_sales.store.name>.
SELECT
    cloudy.\"su_store_sales_customer_last_name\" as \"su_store_sales_customer_last_name\",
    cloudy.\"su_store_sales_customer_first_name\" as \"su_store_sales_customer_first_name\",
    cloudy.\"su_store_sales_store_name\" as \"su_store_sales_store_name\",
    cloudy.\"peach_sales\" as \"peach_sales\"
FROM
    cloudy
    FULL JOIN sparrow on 1=1
WHERE
    cloudy.\"peach_sales\" > 0.05 * sparrow.\"avg_store_customer_sales\"
"""
