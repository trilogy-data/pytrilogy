query_id = 95
gen_length = 5908
generated_sql = """

WITH 
thoughtful as (
SELECT
    web_sales_web_sales.\"WS_ORDER_NUMBER\" as \"web_sales_order_number\",
    web_sales_web_sales.\"WS_WAREHOUSE_SK\" as \"web_sales_warehouse_id\"
FROM
    memory.web_sales as web_sales_web_sales
GROUP BY 
    web_sales_web_sales.\"WS_ORDER_NUMBER\",
    web_sales_web_sales.\"WS_WAREHOUSE_SK\"),
yummy as (
SELECT
    web_sales_web_sales.\"WS_ORDER_NUMBER\" as \"returned_orders\"
FROM
    memory.web_sales as web_sales_web_sales
    LEFT OUTER JOIN memory.web_returns as web_sales_web_returns on web_sales_web_sales.\"WS_ITEM_SK\" = web_sales_web_returns.\"WR_ITEM_SK\" AND web_sales_web_sales.\"WS_ORDER_NUMBER\" = web_sales_web_returns.\"WR_ORDER_NUMBER\"
WHERE
    CASE WHEN WR_ORDER_NUMBER IS NOT NULL THEN 1 else 0 END is True

GROUP BY 
    web_sales_web_sales.\"WS_ORDER_NUMBER\"),
cooperative as (
SELECT
    count(thoughtful.\"web_sales_warehouse_id\") as \"_virt_agg_count_2435454530783120\",
    thoughtful.\"web_sales_order_number\" as \"web_sales_order_number\"
FROM
    thoughtful
GROUP BY 
    thoughtful.\"web_sales_order_number\"),
juicy as (
SELECT
    yummy.\"returned_orders\" as \"returned_orders\"
FROM
    yummy
GROUP BY 
    yummy.\"returned_orders\"),
questionable as (
SELECT
    CASE WHEN cooperative.\"_virt_agg_count_2435454530783120\" > 1 THEN cooperative.\"web_sales_order_number\" ELSE NULL END as \"multi_warehouse_order\"
FROM
    cooperative),
abundant as (
SELECT
    questionable.\"multi_warehouse_order\" as \"multi_warehouse_order\"
FROM
    questionable
GROUP BY 
    questionable.\"multi_warehouse_order\"),
cheerful as (
SELECT
    web_sales_web_sales.\"WS_ORDER_NUMBER\" as \"web_sales_order_number\",
    web_sales_web_sales.\"WS_SHIP_ADDR_SK\" as \"web_sales_ship_address_id\",
    web_sales_web_sales.\"WS_SHIP_DATE_SK\" as \"web_sales_ship_date_id\",
    web_sales_web_sales.\"WS_WEB_SITE_SK\" as \"web_sales_web_site_id\"
FROM
    memory.web_sales as web_sales_web_sales
WHERE
    web_sales_web_sales.\"WS_ORDER_NUMBER\" in (select abundant.\"multi_warehouse_order\" from abundant where abundant.\"multi_warehouse_order\" is not null) and web_sales_web_sales.\"WS_ORDER_NUMBER\" in (select juicy.\"returned_orders\" from juicy where juicy.\"returned_orders\" is not null)

GROUP BY 
    web_sales_web_sales.\"WS_ORDER_NUMBER\",
    web_sales_web_sales.\"WS_SHIP_ADDR_SK\",
    web_sales_web_sales.\"WS_SHIP_DATE_SK\",
    web_sales_web_sales.\"WS_WEB_SITE_SK\"),
young as (
SELECT
    cast(web_sales_ship_date_date.\"D_DATE\" as date) as \"web_sales_ship_date_date\",
    web_sales_ship_address_customer_address.\"CA_STATE\" as \"web_sales_ship_address_state\",
    web_sales_web_sales.\"WS_EXT_SHIP_COST\" as \"web_sales_extra_ship_cost\",
    web_sales_web_sales.\"WS_ITEM_SK\" as \"web_sales_item_id\",
    web_sales_web_sales.\"WS_NET_PROFIT\" as \"web_sales_net_profit\",
    web_sales_web_sales.\"WS_ORDER_NUMBER\" as \"web_sales_order_number\",
    web_sales_web_site_web_site.\"web_company_name\" as \"web_sales_web_site_company_name\"
FROM
    memory.customer_address as web_sales_ship_address_customer_address
    INNER JOIN memory.web_sales as web_sales_web_sales on web_sales_ship_address_customer_address.\"CA_ADDRESS_SK\" = web_sales_web_sales.\"WS_SHIP_ADDR_SK\"
    INNER JOIN memory.web_site as web_sales_web_site_web_site on web_sales_web_sales.\"WS_WEB_SITE_SK\" = web_sales_web_site_web_site.\"web_site_sk\"
    INNER JOIN memory.date_dim as web_sales_ship_date_date on web_sales_web_sales.\"WS_SHIP_DATE_SK\" = web_sales_ship_date_date.\"D_DATE_SK\"
WHERE
    cast(web_sales_ship_date_date.\"D_DATE\" as date) >= date '1999-02-01' and cast(web_sales_ship_date_date.\"D_DATE\" as date) <= date '1999-04-02' and web_sales_ship_address_customer_address.\"CA_STATE\" = 'IL' and web_sales_web_site_web_site.\"web_company_name\" = 'pri' and web_sales_web_sales.\"WS_ORDER_NUMBER\" in (select abundant.\"multi_warehouse_order\" from abundant where abundant.\"multi_warehouse_order\" is not null) and web_sales_web_sales.\"WS_ORDER_NUMBER\" in (select juicy.\"returned_orders\" from juicy where juicy.\"returned_orders\" is not null)
),
vacuous as (
SELECT
    cast(web_sales_ship_date_date.\"D_DATE\" as date) as \"web_sales_ship_date_date\",
    cheerful.\"web_sales_order_number\" as \"web_sales_order_number\",
    web_sales_ship_address_customer_address.\"CA_STATE\" as \"web_sales_ship_address_state\",
    web_sales_web_site_web_site.\"web_company_name\" as \"web_sales_web_site_company_name\"
FROM
    cheerful
    INNER JOIN memory.customer_address as web_sales_ship_address_customer_address on cheerful.\"web_sales_ship_address_id\" = web_sales_ship_address_customer_address.\"CA_ADDRESS_SK\"
    INNER JOIN memory.web_site as web_sales_web_site_web_site on cheerful.\"web_sales_web_site_id\" = web_sales_web_site_web_site.\"web_site_sk\"
    INNER JOIN memory.date_dim as web_sales_ship_date_date on cheerful.\"web_sales_ship_date_id\" = web_sales_ship_date_date.\"D_DATE_SK\"
WHERE
    cast(web_sales_ship_date_date.\"D_DATE\" as date) >= date '1999-02-01' and cast(web_sales_ship_date_date.\"D_DATE\" as date) <= date '1999-04-02' and web_sales_ship_address_customer_address.\"CA_STATE\" = 'IL' and web_sales_web_site_web_site.\"web_company_name\" = 'pri' and cheerful.\"web_sales_order_number\" in (select abundant.\"multi_warehouse_order\" from abundant where abundant.\"multi_warehouse_order\" is not null) and cheerful.\"web_sales_order_number\" in (select juicy.\"returned_orders\" from juicy where juicy.\"returned_orders\" is not null)
),
sparkling as (
SELECT
    sum(young.\"web_sales_extra_ship_cost\") as \"total_shipping_cost\",
    sum(young.\"web_sales_net_profit\") as \"total_net_profit\"
FROM
    young),
concerned as (
SELECT
    count(distinct vacuous.\"web_sales_order_number\") as \"order_count\"
FROM
    vacuous)
SELECT
    concerned.\"order_count\" as \"order_count\",
    sparkling.\"total_shipping_cost\" as \"total_shipping_cost\",
    sparkling.\"total_net_profit\" as \"total_net_profit\"
FROM
    concerned
    FULL JOIN sparkling on 1=1
ORDER BY 
    concerned.\"order_count\" desc
LIMIT (100)"""
