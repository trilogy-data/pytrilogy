query_id = 97
gen_length = 3637
generated_sql = """

WITH 
cooperative as (
SELECT
    catalog_sales_catalog_sales.\"CS_BILL_CUSTOMER_SK\" as \"catalog_sales_bill_customer_id\",
    catalog_sales_catalog_sales.\"CS_ITEM_SK\" as \"catalog_sales_item_id\",
    catalog_sales_catalog_sales.\"CS_SOLD_DATE_SK\" as \"catalog_sales_date_id\"
FROM
    memory.catalog_sales as catalog_sales_catalog_sales
GROUP BY 
    catalog_sales_catalog_sales.\"CS_BILL_CUSTOMER_SK\",
    catalog_sales_catalog_sales.\"CS_ITEM_SK\",
    catalog_sales_catalog_sales.\"CS_SOLD_DATE_SK\"),
dynamic as (
SELECT
    store_sales_store_sales.\"SS_CUSTOMER_SK\" as \"store_sales_customer_id\",
    store_sales_store_sales.\"SS_ITEM_SK\" as \"store_sales_item_id\",
    store_sales_store_sales.\"SS_SOLD_DATE_SK\" as \"store_sales_date_id\"
FROM
    memory.store_sales as store_sales_store_sales
GROUP BY 
    store_sales_store_sales.\"SS_CUSTOMER_SK\",
    store_sales_store_sales.\"SS_ITEM_SK\",
    store_sales_store_sales.\"SS_SOLD_DATE_SK\"),
questionable as (
SELECT
    catalog_sales_date_date.\"D_MONTH_SEQ\" as \"catalog_sales_date_month_seq\",
    cooperative.\"catalog_sales_bill_customer_id\" as \"catalog_sales_bill_customer_id\",
    cooperative.\"catalog_sales_bill_customer_id\" as \"customer_id\",
    cooperative.\"catalog_sales_item_id\" as \"catalog_sales_item_id\",
    cooperative.\"catalog_sales_item_id\" as \"item_id\"
FROM
    cooperative
    INNER JOIN memory.date_dim as catalog_sales_date_date on cooperative.\"catalog_sales_date_id\" = catalog_sales_date_date.\"D_DATE_SK\"
WHERE
    catalog_sales_date_date.\"D_MONTH_SEQ\" >= 1200 and catalog_sales_date_date.\"D_MONTH_SEQ\" <= 1200 + 11
),
wakeful as (
SELECT
    dynamic.\"store_sales_customer_id\" as \"customer_id\",
    dynamic.\"store_sales_customer_id\" as \"store_sales_customer_id\",
    dynamic.\"store_sales_item_id\" as \"item_id\",
    dynamic.\"store_sales_item_id\" as \"store_sales_item_id\",
    store_sales_date_date.\"D_MONTH_SEQ\" as \"store_sales_date_month_seq\"
FROM
    dynamic
    INNER JOIN memory.date_dim as store_sales_date_date on dynamic.\"store_sales_date_id\" = store_sales_date_date.\"D_DATE_SK\"
WHERE
    store_sales_date_date.\"D_MONTH_SEQ\" >= 1200 and store_sales_date_date.\"D_MONTH_SEQ\" <= 1200 + 11
),
abundant as (
SELECT
    coalesce(wakeful.\"customer_id\",questionable.\"customer_id\") as \"merged_customer_id\",
    coalesce(wakeful.\"item_id\",questionable.\"item_id\") as \"merged_item_id\",
    questionable.\"catalog_sales_bill_customer_id\" as \"merged_catalog_sales_bill_customer_id\",
    questionable.\"catalog_sales_item_id\" as \"merged_catalog_sales_item_id\",
    wakeful.\"store_sales_customer_id\" as \"merged_store_sales_customer_id\",
    wakeful.\"store_sales_item_id\" as \"merged_store_sales_item_id\"
FROM
    wakeful
    FULL JOIN questionable on wakeful.\"customer_id\" = questionable.\"customer_id\" AND wakeful.\"item_id\" = questionable.\"item_id\"
GROUP BY 
    coalesce(wakeful.\"customer_id\",questionable.\"customer_id\"),
    coalesce(wakeful.\"item_id\",questionable.\"item_id\"),
    questionable.\"catalog_sales_bill_customer_id\",
    questionable.\"catalog_sales_item_id\",
    wakeful.\"store_sales_customer_id\",
    wakeful.\"store_sales_item_id\")
SELECT
    sum(CASE
	WHEN abundant.\"merged_store_sales_customer_id\" is not null and abundant.\"merged_catalog_sales_bill_customer_id\" is null THEN 1
	ELSE 0
	END) as \"store_sales\",
    sum(CASE
	WHEN abundant.\"merged_store_sales_customer_id\" is null and abundant.\"merged_catalog_sales_bill_customer_id\" is not null THEN 1
	ELSE 0
	END) as \"catalog_sales\",
    sum(CASE
	WHEN abundant.\"merged_store_sales_customer_id\" is not null and abundant.\"merged_catalog_sales_bill_customer_id\" is not null THEN 1
	ELSE 0
	END) as \"both_sales\"
FROM
    abundant"""
