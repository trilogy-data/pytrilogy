query_id = 97
gen_length = 4013
generated_sql = """

WITH 
cooperative as (
SELECT
    \"catalog_sales_catalog_sales\".\"CS_BILL_CUSTOMER_SK\" as \"catalog_sales_bill_customer_id\",
    \"catalog_sales_catalog_sales\".\"CS_ITEM_SK\" as \"catalog_sales_item_id\",
    \"catalog_sales_catalog_sales\".\"CS_SOLD_DATE_SK\" as \"catalog_sales_date_id\"
FROM
    \"memory\".\"catalog_sales\" as \"catalog_sales_catalog_sales\"
GROUP BY 
    \"catalog_sales_catalog_sales\".\"CS_BILL_CUSTOMER_SK\",
    \"catalog_sales_catalog_sales\".\"CS_ITEM_SK\",
    \"catalog_sales_catalog_sales\".\"CS_SOLD_DATE_SK\"),
highfalutin as (
SELECT
    \"store_sales_store_sales\".\"SS_CUSTOMER_SK\" as \"store_sales_customer_id\",
    \"store_sales_store_sales\".\"SS_ITEM_SK\" as \"store_sales_item_id\",
    \"store_sales_store_sales\".\"SS_SOLD_DATE_SK\" as \"store_sales_date_id\"
FROM
    \"memory\".\"store_sales\" as \"store_sales_store_sales\"
GROUP BY 
    \"store_sales_store_sales\".\"SS_CUSTOMER_SK\",
    \"store_sales_store_sales\".\"SS_ITEM_SK\",
    \"store_sales_store_sales\".\"SS_SOLD_DATE_SK\"),
abundant as (
SELECT
    \"cooperative\".\"catalog_sales_bill_customer_id\" as \"catalog_sales_bill_customer_id\",
    \"cooperative\".\"catalog_sales_bill_customer_id\" as \"customer_id\",
    \"cooperative\".\"catalog_sales_item_id\" as \"catalog_sales_item_id\",
    \"cooperative\".\"catalog_sales_item_id\" as \"item_id\"
FROM
    \"cooperative\"
    INNER JOIN \"memory\".\"date_dim\" as \"catalog_sales_date_date\" on \"cooperative\".\"catalog_sales_date_id\" = \"catalog_sales_date_date\".\"D_DATE_SK\"
WHERE
    \"catalog_sales_date_date\".\"D_MONTH_SEQ\" >= 1200 and \"catalog_sales_date_date\".\"D_MONTH_SEQ\" <= 1200 + 11

GROUP BY 
    \"cooperative\".\"catalog_sales_bill_customer_id\",
    \"cooperative\".\"catalog_sales_item_id\"),
cheerful as (
SELECT
    \"highfalutin\".\"store_sales_customer_id\" as \"customer_id\",
    \"highfalutin\".\"store_sales_customer_id\" as \"store_sales_customer_id\",
    \"highfalutin\".\"store_sales_item_id\" as \"item_id\",
    \"highfalutin\".\"store_sales_item_id\" as \"store_sales_item_id\"
FROM
    \"highfalutin\"
    INNER JOIN \"memory\".\"date_dim\" as \"store_sales_date_date\" on \"highfalutin\".\"store_sales_date_id\" = \"store_sales_date_date\".\"D_DATE_SK\"
WHERE
    \"store_sales_date_date\".\"D_MONTH_SEQ\" >= 1200 and \"store_sales_date_date\".\"D_MONTH_SEQ\" <= 1200 + 11

GROUP BY 
    \"highfalutin\".\"store_sales_customer_id\",
    \"highfalutin\".\"store_sales_item_id\"),
uneven as (
SELECT
    \"abundant\".\"catalog_sales_bill_customer_id\" as \"merged_catalog_sales_bill_customer_id\",
    \"abundant\".\"catalog_sales_item_id\" as \"merged_catalog_sales_item_id\",
    \"cheerful\".\"store_sales_customer_id\" as \"merged_store_sales_customer_id\",
    \"cheerful\".\"store_sales_item_id\" as \"merged_store_sales_item_id\"
FROM
    \"cheerful\"
    FULL JOIN \"abundant\" on \"cheerful\".\"customer_id\" is not distinct from \"abundant\".\"customer_id\" AND \"cheerful\".\"item_id\" is not distinct from \"abundant\".\"item_id\"
GROUP BY 
    \"abundant\".\"catalog_sales_bill_customer_id\",
    \"abundant\".\"catalog_sales_item_id\",
    \"cheerful\".\"store_sales_customer_id\",
    \"cheerful\".\"store_sales_item_id\",
    coalesce(\"abundant\".\"customer_id\",\"cheerful\".\"customer_id\"),
    coalesce(\"abundant\".\"item_id\",\"cheerful\".\"item_id\"))
SELECT
    sum(CASE
	WHEN \"uneven\".\"merged_store_sales_customer_id\" is not null and \"uneven\".\"merged_store_sales_item_id\" is not null and \"uneven\".\"merged_catalog_sales_bill_customer_id\" is null and \"uneven\".\"merged_catalog_sales_item_id\" is null THEN 1
	ELSE 0
	END) as \"store_sale_count\",
    sum(CASE
	WHEN \"uneven\".\"merged_store_sales_customer_id\" is null and \"uneven\".\"merged_store_sales_item_id\" is null and \"uneven\".\"merged_catalog_sales_bill_customer_id\" is not null and \"uneven\".\"merged_catalog_sales_item_id\" is not null THEN 1
	ELSE 0
	END) as \"catalog_sale_count\",
    sum(CASE
	WHEN \"uneven\".\"merged_store_sales_customer_id\" is not null and \"uneven\".\"merged_store_sales_item_id\" is not null and \"uneven\".\"merged_catalog_sales_bill_customer_id\" is not null and \"uneven\".\"merged_catalog_sales_item_id\" is not null THEN 1
	ELSE 0
	END) as \"both_sale_count\"
FROM
    \"uneven\""""
