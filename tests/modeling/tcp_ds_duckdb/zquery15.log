query_id = 15
parse_time = 10.098092
exec_time = 0.971807
comp_time = 0.551781
gen_length = 2923
generated_sql = """

WITH 
razorbill as (
SELECT
    customer_address.\"CA_ADDRESS_SK\" as \"catalog_sales_bill_customer_address_id\",
    customers.\"C_CUSTOMER_SK\" as \"catalog_sales_bill_customer_id\",
    customer_address.\"CA_STATE\" as \"catalog_sales_bill_customer_state\",
    customer_address.\"CA_ZIP\" as \"catalog_sales_bill_customer_zip\"
FROM
    memory.customer_address as customer_address
    INNER JOIN memory.customer as customers on customer_address.\"CA_ADDRESS_SK\" = customers.\"C_CURRENT_ADDR_SK\"),
kestrel as (
SELECT
    catalog_sales.\"CS_SOLD_DATE_SK\" as \"catalog_sales_date_id\",
    catalog_sales.\"CS_BILL_CUSTOMER_SK\" as \"catalog_sales_bill_customer_id\",
    date.\"D_QOY\" as \"catalog_sales_date_quarter\",
    cast(\"D_YEAR\" as int) as \"catalog_sales_date_year\",
    catalog_sales.\"CS_ITEM_SK\" as \"catalog_sales_item_id\",
    catalog_sales.\"CS_ORDER_NUMBER\" as \"catalog_sales_order_number\",
    catalog_sales.\"CS_SALES_PRICE\" as \"catalog_sales_sales_price\"
FROM
    memory.catalog_sales as catalog_sales
    INNER JOIN memory.date_dim as date on catalog_sales.\"CS_SOLD_DATE_SK\" = date.\"D_DATE_SK\"),
dapper as (
SELECT
    kestrel.\"catalog_sales_sales_price\" as \"catalog_sales_sales_price\",
    kestrel.\"catalog_sales_date_quarter\" as \"catalog_sales_date_quarter\",
    kestrel.\"catalog_sales_date_year\" as \"catalog_sales_date_year\",
    razorbill.\"catalog_sales_bill_customer_state\" as \"catalog_sales_bill_customer_state\",
    razorbill.\"catalog_sales_bill_customer_zip\" as \"catalog_sales_bill_customer_zip\",
    kestrel.\"catalog_sales_order_number\" as \"catalog_sales_order_number\",
    kestrel.\"catalog_sales_item_id\" as \"catalog_sales_item_id\"
FROM
    razorbill
    LEFT OUTER JOIN kestrel on razorbill.\"catalog_sales_bill_customer_id\" = kestrel.\"catalog_sales_bill_customer_id\"),
stork as (
SELECT
    CASE WHEN dapper.\"catalog_sales_date_quarter\" = 2 and dapper.\"catalog_sales_date_year\" = 2001 and ( dapper.\"catalog_sales_bill_customer_state\" in ( 'CA','WA','GA' ) or dapper.\"catalog_sales_sales_price\" > 500 or SUBSTRING(dapper.\"catalog_sales_bill_customer_zip\",1,5) in ( '85669','86197','88274','83405','86475','85392','85460','80348','81792' ) ) THEN dapper.\"catalog_sales_sales_price\" ELSE NULL END as \"relevant_sales\",
    dapper.\"catalog_sales_bill_customer_zip\" as \"catalog_sales_bill_customer_zip\",
    dapper.\"catalog_sales_order_number\" as \"catalog_sales_order_number\",
    dapper.\"catalog_sales_item_id\" as \"catalog_sales_item_id\"
FROM
    dapper),
badger as (
SELECT
    sum(stork.\"relevant_sales\") as \"sales\",
    stork.\"catalog_sales_bill_customer_zip\" as \"catalog_sales_bill_customer_zip\"
FROM
    stork
GROUP BY 
    stork.\"catalog_sales_bill_customer_zip\")
SELECT
    badger.\"catalog_sales_bill_customer_zip\" as \"catalog_sales_bill_customer_zip\",
    badger.\"sales\" as \"sales\"
FROM
    badger
WHERE
    badger.\"sales\" is not null

ORDER BY 
    badger.\"catalog_sales_bill_customer_zip\" asc nulls first
LIMIT (100)"""
