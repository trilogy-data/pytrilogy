query_id = 20
parse_time = 13.863651
exec_time = 2.009642
comp_time = 0.383403
generated_sql = """

WITH 
ray as (
SELECT
    items.\"I_CATEGORY\" as \"cs_item_category\",
    items.\"I_CLASS\" as \"cs_item_class\",
    items.\"I_CURRENT_PRICE\" as \"cs_item_current_price\",
    items.\"I_ITEM_DESC\" as \"cs_item_desc\",
    items.\"I_ITEM_ID\" as \"cs_item_name\",
    items.\"I_ITEM_SK\" as \"cs_item_id\"
FROM
    memory.item as items
WHERE
    items.\"I_CATEGORY\" in ( 'Sports','Books','Home' )
),
petrel as (
SELECT
    catalog_sales.\"CS_ITEM_SK\" as \"cs_item_id\",
    catalog_sales.\"CS_SOLD_DATE_SK\" as \"cs_sold_date_id\"
FROM
    memory.catalog_sales as catalog_sales
GROUP BY 
    catalog_sales.\"CS_ITEM_SK\",
    catalog_sales.\"CS_SOLD_DATE_SK\"),
nondescript as (
SELECT
    catalog_sales.\"CS_EXT_SALES_PRICE\" as \"cs_extra_sales_price_filter_3197596984767774\",
    catalog_sales.\"CS_ITEM_SK\" as \"cs_item_id\",
    catalog_sales.\"CS_ORDER_NUMBER\" as \"cs_order_number\"
FROM
    memory.catalog_sales as catalog_sales
    LEFT OUTER JOIN ray on catalog_sales.\"CS_ITEM_SK\" = ray.\"cs_item_id\"
    LEFT OUTER JOIN memory.date_dim as date on catalog_sales.\"CS_SOLD_DATE_SK\" = date.\"D_DATE_SK\"
WHERE
    ray.\"cs_item_category\" in ( 'Sports','Books','Home' ) and date.\"D_DATE\" >= cast('1999-02-22' as date) and date.\"D_DATE\" <= cast('1999-03-24' as date)
),
lion as (
SELECT
    catalog_sales.\"CS_EXT_SALES_PRICE\" as \"cs_extra_sales_price\",
    ray.\"cs_item_category\" as \"cs_item_category\",
    date.\"D_DATE\" as \"cs_sold_date_date\",
    ray.\"cs_item_class\" as \"cs_item_class\",
    ray.\"cs_item_current_price\" as \"cs_item_current_price\",
    ray.\"cs_item_desc\" as \"cs_item_desc\",
    ray.\"cs_item_name\" as \"cs_item_name\",
    catalog_sales.\"CS_ORDER_NUMBER\" as \"cs_order_number\",
    catalog_sales.\"CS_ITEM_SK\" as \"cs_item_id\"
FROM
    memory.catalog_sales as catalog_sales
    LEFT OUTER JOIN ray on catalog_sales.\"CS_ITEM_SK\" = ray.\"cs_item_id\"
    LEFT OUTER JOIN memory.date_dim as date on catalog_sales.\"CS_SOLD_DATE_SK\" = date.\"D_DATE_SK\"
WHERE
    ray.\"cs_item_category\" in ( 'Sports','Books','Home' )
),
blue as (
SELECT
    items.\"I_ITEM_SK\" as \"cs_item_id\",
    items.\"I_CATEGORY\" as \"cs_item_category\",
    items.\"I_CLASS\" as \"cs_item_class\",
    items.\"I_CURRENT_PRICE\" as \"cs_item_current_price\",
    items.\"I_ITEM_DESC\" as \"cs_item_desc\",
    items.\"I_ITEM_ID\" as \"cs_item_name\",
    petrel.\"cs_sold_date_id\" as \"cs_sold_date_id\"
FROM
    petrel
    LEFT OUTER JOIN memory.item as items on petrel.\"cs_item_id\" = items.\"I_ITEM_SK\"
WHERE
    items.\"I_CATEGORY\" in ( 'Sports','Books','Home' )
),
elegant as (
SELECT
    nondescript.\"cs_extra_sales_price_filter_3197596984767774\" as \"cs_extra_sales_price_filter_3197596984767774\",
    items.\"I_CATEGORY\" as \"cs_item_category\",
    items.\"I_CLASS\" as \"cs_item_class\",
    items.\"I_CURRENT_PRICE\" as \"cs_item_current_price\",
    items.\"I_ITEM_DESC\" as \"cs_item_desc\",
    items.\"I_ITEM_ID\" as \"cs_item_name\",
    nondescript.\"cs_order_number\" as \"cs_order_number\",
    nondescript.\"cs_item_id\" as \"cs_item_id\"
FROM
    nondescript
    LEFT OUTER JOIN memory.item as items on nondescript.\"cs_item_id\" = items.\"I_ITEM_SK\"
WHERE
    items.\"I_CATEGORY\" in ( 'Sports','Books','Home' )
),
cockatoo as (
SELECT
    CASE WHEN lion.\"cs_item_category\" in ( 'Sports','Books','Home' ) and lion.\"cs_sold_date_date\" >= cast('1999-02-22' as date) and lion.\"cs_sold_date_date\" <= cast('1999-03-24' as date) THEN lion.\"cs_extra_sales_price\" ELSE NULL END as \"cs_extra_sales_price_filter_3197596984767774\",
    lion.\"cs_order_number\" as \"cs_order_number\",
    lion.\"cs_item_id\" as \"cs_item_id\"
FROM
    lion),
brave as (
SELECT
    blue.\"cs_item_category\" as \"cs_item_category\",
    blue.\"cs_item_class\" as \"cs_item_class\",
    blue.\"cs_item_current_price\" as \"cs_item_current_price\",
    blue.\"cs_item_desc\" as \"cs_item_desc\",
    blue.\"cs_item_name\" as \"cs_item_name\",
    date.\"D_DATE\" as \"cs_sold_date_date\"
FROM
    memory.date_dim as date
    LEFT OUTER JOIN blue on date.\"D_DATE_SK\" = blue.\"cs_sold_date_id\"
WHERE
    blue.\"cs_item_category\" in ( 'Sports','Books','Home' ) and date.\"D_DATE\" >= cast('1999-02-22' as date) and date.\"D_DATE\" <= cast('1999-03-24' as date)
),
eminent as (
SELECT
    sum(elegant.\"cs_extra_sales_price_filter_3197596984767774\") as \"revenue\",
    elegant.\"cs_item_category\" as \"cs_item_category\",
    elegant.\"cs_item_class\" as \"cs_item_class\",
    elegant.\"cs_item_current_price\" as \"cs_item_current_price\",
    elegant.\"cs_item_desc\" as \"cs_item_desc\",
    elegant.\"cs_item_name\" as \"cs_item_name\"
FROM
    elegant
GROUP BY 
    elegant.\"cs_item_desc\",
    elegant.\"cs_item_current_price\",
    elegant.\"cs_item_category\",
    elegant.\"cs_item_class\",
    elegant.\"cs_item_name\"),
pelican as (
SELECT
    cockatoo.\"cs_extra_sales_price_filter_3197596984767774\" as \"cs_extra_sales_price_filter_3197596984767774\",
    items.\"I_CATEGORY\" as \"cs_item_category\",
    items.\"I_CLASS\" as \"cs_item_class\",
    items.\"I_CURRENT_PRICE\" as \"cs_item_current_price\",
    items.\"I_ITEM_DESC\" as \"cs_item_desc\",
    items.\"I_ITEM_ID\" as \"cs_item_name\",
    cockatoo.\"cs_order_number\" as \"cs_order_number\",
    cockatoo.\"cs_item_id\" as \"cs_item_id\"
FROM
    cockatoo
    LEFT OUTER JOIN memory.item as items on cockatoo.\"cs_item_id\" = items.\"I_ITEM_SK\"
WHERE
    items.\"I_CATEGORY\" in ( 'Sports','Books','Home' )
),
budgie as (
SELECT
    sum(pelican.\"cs_extra_sales_price_filter_3197596984767774\") as \"_virtual_364582426434762\",
    pelican.\"cs_item_category\" as \"cs_item_category\",
    pelican.\"cs_item_class\" as \"cs_item_class\",
    pelican.\"cs_item_current_price\" as \"cs_item_current_price\",
    pelican.\"cs_item_desc\" as \"cs_item_desc\",
    pelican.\"cs_item_name\" as \"cs_item_name\",
    sum(pelican.\"cs_extra_sales_price_filter_3197596984767774\") as \"_agg_sum_364582426434762\"
FROM
    pelican
GROUP BY 
    pelican.\"cs_item_desc\",
    pelican.\"cs_item_category\",
    pelican.\"cs_item_name\",
    pelican.\"cs_item_class\",
    pelican.\"cs_item_current_price\"),
human as (
SELECT
    sum(budgie.\"_agg_sum_364582426434762\") over (partition by budgie.\"cs_item_class\") as \"_virtual_6172232945537998\",
    budgie.\"_agg_sum_364582426434762\" as \"_agg_sum_364582426434762\",
    budgie.\"cs_item_class\" as \"cs_item_class\"
FROM
    budgie),
duck as (
SELECT
    brave.\"cs_item_category\" as \"cs_item_category\",
    brave.\"cs_item_class\" as \"cs_item_class\",
    brave.\"cs_item_current_price\" as \"cs_item_current_price\",
    brave.\"cs_item_desc\" as \"cs_item_desc\",
    brave.\"cs_item_name\" as \"cs_item_name\",
    brave.\"cs_sold_date_date\" as \"cs_sold_date_date\",
    budgie.\"_agg_sum_364582426434762\" as \"_agg_sum_364582426434762\"
FROM
    brave
    LEFT OUTER JOIN budgie on ((brave.\"cs_item_category\" is null and budgie.\"cs_item_category\" is null) or (brave.\"cs_item_category\" = budgie.\"cs_item_category\")) AND ((brave.\"cs_item_class\" is null and budgie.\"cs_item_class\" is null) or (brave.\"cs_item_class\" = budgie.\"cs_item_class\")) AND ((brave.\"cs_item_current_price\" is null and budgie.\"cs_item_current_price\" is null) or (brave.\"cs_item_current_price\" = budgie.\"cs_item_current_price\")) AND ((brave.\"cs_item_desc\" is null and budgie.\"cs_item_desc\" is null) or (brave.\"cs_item_desc\" = budgie.\"cs_item_desc\")) AND brave.\"cs_item_name\" = budgie.\"cs_item_name\"
WHERE
    brave.\"cs_item_category\" in ( 'Sports','Books','Home' ) and brave.\"cs_sold_date_date\" >= cast('1999-02-22' as date) and brave.\"cs_sold_date_date\" <= cast('1999-03-24' as date)
),
sordid as (
SELECT
    duck.\"_agg_sum_364582426434762\" as \"_agg_sum_364582426434762\",
    duck.\"cs_item_class\" as \"cs_item_class\",
    duck.\"cs_item_category\" as \"cs_item_category\",
    duck.\"cs_item_current_price\" as \"cs_item_current_price\",
    duck.\"cs_sold_date_date\" as \"cs_sold_date_date\",
    duck.\"cs_item_desc\" as \"cs_item_desc\",
    duck.\"cs_item_name\" as \"cs_item_name\",
    human.\"_virtual_6172232945537998\" as \"_virtual_6172232945537998\"
FROM
    duck
    LEFT OUTER JOIN human on duck.\"_agg_sum_364582426434762\" = human.\"_agg_sum_364582426434762\" AND ((duck.\"cs_item_class\" is null and human.\"cs_item_class\" is null) or (duck.\"cs_item_class\" = human.\"cs_item_class\"))
WHERE
    duck.\"cs_item_category\" in ( 'Sports','Books','Home' ) and duck.\"cs_sold_date_date\" >= cast('1999-02-22' as date) and duck.\"cs_sold_date_date\" <= cast('1999-03-24' as date)
),
level as (
SELECT
    sordid.\"cs_item_category\" as \"cs_item_category\",
    sordid.\"cs_item_class\" as \"cs_item_class\",
    sordid.\"cs_item_current_price\" as \"cs_item_current_price\",
    sordid.\"cs_item_desc\" as \"cs_item_desc\",
    sordid.\"cs_item_name\" as \"cs_item_name\",
    sordid.\"cs_sold_date_date\" as \"cs_sold_date_date\",
    budgie.\"_virtual_364582426434762\" * 100.0 / sordid.\"_virtual_6172232945537998\" as \"revenue_ratio\"
FROM
    sordid
    LEFT OUTER JOIN budgie on ((sordid.\"cs_item_category\" is null and budgie.\"cs_item_category\" is null) or (sordid.\"cs_item_category\" = budgie.\"cs_item_category\")) AND ((sordid.\"cs_item_class\" is null and budgie.\"cs_item_class\" is null) or (sordid.\"cs_item_class\" = budgie.\"cs_item_class\")) AND ((sordid.\"cs_item_current_price\" is null and budgie.\"cs_item_current_price\" is null) or (sordid.\"cs_item_current_price\" = budgie.\"cs_item_current_price\")) AND ((sordid.\"cs_item_desc\" is null and budgie.\"cs_item_desc\" is null) or (sordid.\"cs_item_desc\" = budgie.\"cs_item_desc\")) AND sordid.\"cs_item_name\" = budgie.\"cs_item_name\"
WHERE
    sordid.\"cs_item_category\" in ( 'Sports','Books','Home' ) and sordid.\"cs_sold_date_date\" >= cast('1999-02-22' as date) and sordid.\"cs_sold_date_date\" <= cast('1999-03-24' as date)
),
kaput as (
SELECT
    level.\"cs_item_category\" as \"cs_item_category\",
    level.\"cs_item_class\" as \"cs_item_class\",
    level.\"cs_item_current_price\" as \"cs_item_current_price\",
    level.\"cs_item_desc\" as \"cs_item_desc\",
    level.\"cs_item_name\" as \"cs_item_name\",
    level.\"cs_sold_date_date\" as \"cs_sold_date_date\",
    level.\"revenue_ratio\" as \"revenue_ratio\",
    eminent.\"revenue\" as \"revenue\"
FROM
    level
    LEFT OUTER JOIN eminent on ((level.\"cs_item_category\" is null and eminent.\"cs_item_category\" is null) or (level.\"cs_item_category\" = eminent.\"cs_item_category\")) AND ((level.\"cs_item_class\" is null and eminent.\"cs_item_class\" is null) or (level.\"cs_item_class\" = eminent.\"cs_item_class\")) AND ((level.\"cs_item_current_price\" is null and eminent.\"cs_item_current_price\" is null) or (level.\"cs_item_current_price\" = eminent.\"cs_item_current_price\")) AND ((level.\"cs_item_desc\" is null and eminent.\"cs_item_desc\" is null) or (level.\"cs_item_desc\" = eminent.\"cs_item_desc\")) AND level.\"cs_item_name\" = eminent.\"cs_item_name\"
WHERE
    level.\"cs_item_category\" in ( 'Sports','Books','Home' ) and level.\"cs_sold_date_date\" >= cast('1999-02-22' as date) and level.\"cs_sold_date_date\" <= cast('1999-03-24' as date)
)
SELECT
    kaput.\"cs_item_name\" as \"cs_item_name\",
    kaput.\"cs_item_desc\" as \"cs_item_desc\",
    kaput.\"cs_item_category\" as \"cs_item_category\",
    kaput.\"cs_item_class\" as \"cs_item_class\",
    kaput.\"cs_item_current_price\" as \"cs_item_current_price\",
    kaput.\"revenue\" as \"revenue\",
    kaput.\"revenue_ratio\" as \"revenue_ratio\"
FROM
    kaput
WHERE
    kaput.\"cs_item_category\" in ( 'Sports','Books','Home' ) and kaput.\"cs_sold_date_date\" >= cast('1999-02-22' as date) and kaput.\"cs_sold_date_date\" <= cast('1999-03-24' as date)

GROUP BY 
    kaput.\"cs_item_category\",
    kaput.\"cs_item_name\",
    kaput.\"revenue\",
    kaput.\"revenue_ratio\",
    kaput.\"cs_item_current_price\",
    kaput.\"cs_item_desc\",
    kaput.\"cs_item_class\"
ORDER BY 
    kaput.\"cs_item_category\" asc nulls first,
    kaput.\"cs_item_class\" asc nulls first,
    kaput.\"cs_item_name\" asc nulls first,
    kaput.\"cs_item_desc\" asc nulls first,
    kaput.\"revenue_ratio\" asc nulls first
LIMIT (100)"""
