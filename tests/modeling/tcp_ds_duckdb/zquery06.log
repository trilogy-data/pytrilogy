query_id = 6
parse_time = 12.786558
exec_time = 7.555843
comp_time = 0.827707
gen_length = 6724
generated_sql = """

WITH 
hawk as (
SELECT
    store_sales.\"SS_SOLD_DATE_SK\" as \"store_sales_date_id\",
    store_sales.\"SS_ITEM_SK\" as \"item_id\",
    store_sales.\"SS_CUSTOMER_SK\" as \"store_sales_customer_id\"
FROM
    memory.store_sales as store_sales
GROUP BY 
    store_sales.\"SS_ITEM_SK\",
    store_sales.\"SS_CUSTOMER_SK\",
    store_sales.\"SS_SOLD_DATE_SK\"),
jaguar as (
SELECT
    customers.\"C_CURRENT_ADDR_SK\" as \"store_sales_customer_address_id\",
    customers.\"C_CUSTOMER_SK\" as \"store_sales_customer_id\",
    customer_address.\"CA_STATE\" as \"store_sales_customer_state\"
FROM
    memory.customer as customers
    INNER JOIN memory.customer_address as customer_address on customers.\"C_CURRENT_ADDR_SK\" = customer_address.\"CA_ADDRESS_SK\"),
chimpanzee as (
SELECT
    items.\"I_CURRENT_PRICE\" as \"store_sales_item_current_price\",
    items.\"I_ITEM_SK\" as \"item_id\"
FROM
    memory.item as items),
ocelot as (
SELECT
    avg(items.\"I_CURRENT_PRICE\") as \"_virtual_6264207893106521\",
    items.\"I_CATEGORY\" as \"item_category\"
FROM
    memory.item as items
WHERE
    items.\"I_CATEGORY\" is not null

GROUP BY 
    items.\"I_CATEGORY\"),
courageous as (
SELECT
    date.\"D_DATE_SK\" as \"store_sales_date_id\",
    hawk.\"item_id\" as \"item_id\",
    hawk.\"store_sales_customer_id\" as \"store_sales_customer_id\",
    date.\"D_MOY\" as \"store_sales_date_month_of_year\",
    cast(\"D_YEAR\" as int) as \"store_sales_date_year\"
FROM
    hawk
    INNER JOIN memory.date_dim as date on hawk.\"store_sales_date_id\" = date.\"D_DATE_SK\"
WHERE
    cast(\"D_YEAR\" as int) = 2001 and date.\"D_MOY\" = 1
),
swift as (
SELECT
    items.\"I_CATEGORY\" as \"item_category\",
    chimpanzee.\"store_sales_item_current_price\" as \"store_sales_item_current_price\",
    courageous.\"store_sales_date_month_of_year\" as \"store_sales_date_month_of_year\",
    jaguar.\"store_sales_customer_state\" as \"store_sales_customer_state\",
    courageous.\"store_sales_date_year\" as \"store_sales_date_year\",
    jaguar.\"store_sales_customer_id\" as \"store_sales_customer_id\"
FROM
    jaguar
    LEFT OUTER JOIN courageous on jaguar.\"store_sales_customer_id\" = courageous.\"store_sales_customer_id\"
    INNER JOIN memory.item as items on courageous.\"item_id\" = items.\"I_ITEM_SK\"
    INNER JOIN chimpanzee on courageous.\"item_id\" = chimpanzee.\"item_id\"
WHERE
    courageous.\"store_sales_date_year\" = 2001 and courageous.\"store_sales_date_month_of_year\" = 1 and items.\"I_CATEGORY\" is not null
),
wakeful as (
SELECT
    swift.\"item_category\" as \"item_category\",
    swift.\"store_sales_item_current_price\" as \"store_sales_item_current_price\",
    swift.\"store_sales_date_month_of_year\" as \"store_sales_date_month_of_year\",
    swift.\"store_sales_customer_state\" as \"store_sales_customer_state\",
    swift.\"store_sales_date_year\" as \"store_sales_date_year\",
    ocelot.\"_virtual_6264207893106521\" as \"_virtual_6264207893106521\"
FROM
    swift
    INNER JOIN ocelot on (swift.\"item_category\" = ocelot.\"item_category\" or (swift.\"item_category\" is null and ocelot.\"item_category\" is null))
WHERE
    swift.\"store_sales_date_year\" = 2001 and swift.\"store_sales_date_month_of_year\" = 1 and swift.\"store_sales_item_current_price\" > 1.2 * ocelot.\"_virtual_6264207893106521\" and swift.\"item_category\" is not null
),
wolverine as (
SELECT
    swift.\"store_sales_customer_id\" as \"store_sales_customer_id_filter_5640408687474034\",
    swift.\"store_sales_customer_state\" as \"store_sales_customer_state\"
FROM
    swift
    INNER JOIN ocelot on (swift.\"item_category\" = ocelot.\"item_category\" or (swift.\"item_category\" is null and ocelot.\"item_category\" is null))
WHERE
    swift.\"store_sales_date_year\" = 2001 and swift.\"store_sales_date_month_of_year\" = 1 and swift.\"store_sales_item_current_price\" > 1.2 * ocelot.\"_virtual_6264207893106521\" and swift.\"item_category\" is not null
),
canary as (
SELECT
    count(wolverine.\"store_sales_customer_id_filter_5640408687474034\") as \"customer_count\",
    wolverine.\"store_sales_customer_state\" as \"store_sales_customer_state\"
FROM
    wolverine
GROUP BY 
    wolverine.\"store_sales_customer_state\"),
snipe as (
SELECT
    swift.\"store_sales_customer_state\" as \"store_sales_customer_state\",
    swift.\"item_category\" as \"item_category\",
    swift.\"store_sales_item_current_price\" as \"store_sales_item_current_price\",
    swift.\"store_sales_date_month_of_year\" as \"store_sales_date_month_of_year\",
    swift.\"store_sales_date_year\" as \"store_sales_date_year\",
    canary.\"customer_count\" as \"customer_count\"
FROM
    swift
    INNER JOIN canary on (swift.\"store_sales_customer_state\" = canary.\"store_sales_customer_state\" or (swift.\"store_sales_customer_state\" is null and canary.\"store_sales_customer_state\" is null))
WHERE
    swift.\"store_sales_date_year\" = 2001 and swift.\"store_sales_date_month_of_year\" = 1 and swift.\"item_category\" is not null
),
boa as (
SELECT
    snipe.\"store_sales_date_year\" as \"store_sales_date_year\",
    snipe.\"store_sales_date_month_of_year\" as \"store_sales_date_month_of_year\",
    snipe.\"store_sales_item_current_price\" as \"store_sales_item_current_price\",
    wakeful.\"_virtual_6264207893106521\" as \"_virtual_6264207893106521\",
    snipe.\"item_category\" as \"item_category\",
    snipe.\"store_sales_customer_state\" as \"store_sales_customer_state\",
    snipe.\"customer_count\" as \"customer_count\"
FROM
    snipe
    INNER JOIN wakeful on (snipe.\"store_sales_customer_state\" = wakeful.\"store_sales_customer_state\" or (snipe.\"store_sales_customer_state\" is null and wakeful.\"store_sales_customer_state\" is null)) AND (snipe.\"item_category\" = wakeful.\"item_category\" or (snipe.\"item_category\" is null and wakeful.\"item_category\" is null)) AND (snipe.\"store_sales_item_current_price\" = wakeful.\"store_sales_item_current_price\" or (snipe.\"store_sales_item_current_price\" is null and wakeful.\"store_sales_item_current_price\" is null)) AND snipe.\"store_sales_date_month_of_year\" = wakeful.\"store_sales_date_month_of_year\" AND snipe.\"store_sales_date_year\" = wakeful.\"store_sales_date_year\"
WHERE
    snipe.\"store_sales_date_year\" = 2001 and snipe.\"store_sales_date_month_of_year\" = 1 and snipe.\"store_sales_item_current_price\" > 1.2 * wakeful.\"_virtual_6264207893106521\" and snipe.\"item_category\" is not null
)
SELECT
    boa.\"store_sales_customer_state\" as \"store_sales_customer_state\",
    boa.\"customer_count\" as \"customer_count\"
FROM
    boa
WHERE
    boa.\"customer_count\" >= 10 and boa.\"store_sales_date_year\" = 2001 and boa.\"store_sales_date_month_of_year\" = 1 and boa.\"store_sales_item_current_price\" > 1.2 * boa.\"_virtual_6264207893106521\" and boa.\"item_category\" is not null

GROUP BY 
    boa.\"store_sales_customer_state\",
    boa.\"customer_count\"
ORDER BY 
    boa.\"customer_count\" asc nulls first,
    boa.\"store_sales_customer_state\" asc nulls first"""
