query_id = 6
parse_time = 2.681704
exec_time = 0.651593
comp_time = 0.093812
gen_length = 6871
generated_sql = """

WITH 
spiritual as (
SELECT
    store_sales.\"SS_SOLD_DATE_SK\" as \"store_sales_date_id\",
    store_sales.\"SS_ITEM_SK\" as \"item_id\",
    store_sales.\"SS_CUSTOMER_SK\" as \"store_sales_customer_id\"
FROM
    memory.store_sales as store_sales
GROUP BY 
    store_sales.\"SS_CUSTOMER_SK\",
    store_sales.\"SS_ITEM_SK\",
    store_sales.\"SS_SOLD_DATE_SK\"),
goldfinch as (
SELECT
    customers.\"C_CURRENT_ADDR_SK\" as \"store_sales_customer_address_id\",
    customers.\"C_CUSTOMER_SK\" as \"store_sales_customer_id\",
    customer_address.\"CA_STATE\" as \"store_sales_customer_state\"
FROM
    memory.customer as customers
    LEFT OUTER JOIN memory.customer_address as customer_address on customers.\"C_CURRENT_ADDR_SK\" = customer_address.\"CA_ADDRESS_SK\"),
human as (
SELECT
    items.\"I_CURRENT_PRICE\" as \"store_sales_item_current_price\",
    items.\"I_ITEM_SK\" as \"item_id\"
FROM
    memory.item as items),
dynamic as (
SELECT
    avg(items.\"I_CURRENT_PRICE\") as \"_virtual_6264207893106521\",
    items.\"I_CATEGORY\" as \"item_category\"
FROM
    memory.item as items
WHERE
    items.\"I_CATEGORY\" is not null

GROUP BY 
    items.\"I_CATEGORY\"),
jackdaw as (
SELECT
    date.\"D_DATE_SK\" as \"store_sales_date_id\",
    spiritual.\"item_id\" as \"item_id\",
    spiritual.\"store_sales_customer_id\" as \"store_sales_customer_id\",
    date.\"D_MOY\" as \"store_sales_date_month_of_year\",
    cast(\"D_YEAR\" as int) as \"store_sales_date_year\"
FROM
    spiritual
    LEFT OUTER JOIN memory.date_dim as date on spiritual.\"store_sales_date_id\" = date.\"D_DATE_SK\"
WHERE
    cast(\"D_YEAR\" as int) = 2001 and date.\"D_MOY\" = 1
),
thoughtful as (
SELECT
    items.\"I_CATEGORY\" as \"item_category\",
    human.\"store_sales_item_current_price\" as \"store_sales_item_current_price\",
    jackdaw.\"store_sales_date_month_of_year\" as \"store_sales_date_month_of_year\",
    goldfinch.\"store_sales_customer_state\" as \"store_sales_customer_state\",
    jackdaw.\"store_sales_date_year\" as \"store_sales_date_year\",
    goldfinch.\"store_sales_customer_id\" as \"store_sales_customer_id\"
FROM
    goldfinch
    LEFT OUTER JOIN jackdaw on goldfinch.\"store_sales_customer_id\" = jackdaw.\"store_sales_customer_id\"
    LEFT OUTER JOIN memory.item as items on jackdaw.\"item_id\" = items.\"I_ITEM_SK\"
    LEFT OUTER JOIN human on jackdaw.\"item_id\" = human.\"item_id\"
WHERE
    jackdaw.\"store_sales_date_year\" = 2001 and jackdaw.\"store_sales_date_month_of_year\" = 1 and items.\"I_CATEGORY\" is not null
),
jackal as (
SELECT
    thoughtful.\"item_category\" as \"item_category\",
    thoughtful.\"store_sales_item_current_price\" as \"store_sales_item_current_price\",
    thoughtful.\"store_sales_date_month_of_year\" as \"store_sales_date_month_of_year\",
    thoughtful.\"store_sales_customer_state\" as \"store_sales_customer_state\",
    thoughtful.\"store_sales_date_year\" as \"store_sales_date_year\",
    dynamic.\"_virtual_6264207893106521\" as \"_virtual_6264207893106521\"
FROM
    thoughtful
    LEFT OUTER JOIN dynamic on ((thoughtful.\"item_category\" is null and dynamic.\"item_category\" is null) or (thoughtful.\"item_category\" = dynamic.\"item_category\"))
WHERE
    thoughtful.\"store_sales_date_year\" = 2001 and thoughtful.\"store_sales_date_month_of_year\" = 1 and thoughtful.\"store_sales_item_current_price\" > 1.2 * dynamic.\"_virtual_6264207893106521\" and thoughtful.\"item_category\" is not null
),
dove as (
SELECT
    thoughtful.\"store_sales_customer_id\" as \"store_sales_customer_id_filter_5640408687474034\",
    thoughtful.\"store_sales_customer_state\" as \"store_sales_customer_state\"
FROM
    thoughtful
    LEFT OUTER JOIN dynamic on ((thoughtful.\"item_category\" is null and dynamic.\"item_category\" is null) or (thoughtful.\"item_category\" = dynamic.\"item_category\"))
WHERE
    thoughtful.\"store_sales_date_year\" = 2001 and thoughtful.\"store_sales_date_month_of_year\" = 1 and thoughtful.\"store_sales_item_current_price\" > 1.2 * dynamic.\"_virtual_6264207893106521\" and thoughtful.\"item_category\" is not null
),
vast as (
SELECT
    count(dove.\"store_sales_customer_id_filter_5640408687474034\") as \"customer_count\",
    dove.\"store_sales_customer_state\" as \"store_sales_customer_state\"
FROM
    dove
GROUP BY 
    dove.\"store_sales_customer_state\"),
jay as (
SELECT
    thoughtful.\"store_sales_customer_state\" as \"store_sales_customer_state\",
    thoughtful.\"item_category\" as \"item_category\",
    thoughtful.\"store_sales_item_current_price\" as \"store_sales_item_current_price\",
    thoughtful.\"store_sales_date_month_of_year\" as \"store_sales_date_month_of_year\",
    thoughtful.\"store_sales_date_year\" as \"store_sales_date_year\",
    vast.\"customer_count\" as \"customer_count\"
FROM
    thoughtful
    LEFT OUTER JOIN vast on ((thoughtful.\"store_sales_customer_state\" is null and vast.\"store_sales_customer_state\" is null) or (thoughtful.\"store_sales_customer_state\" = vast.\"store_sales_customer_state\"))
WHERE
    thoughtful.\"store_sales_date_year\" = 2001 and thoughtful.\"store_sales_date_month_of_year\" = 1 and thoughtful.\"item_category\" is not null
),
rook as (
SELECT
    jay.\"store_sales_date_year\" as \"store_sales_date_year\",
    jay.\"store_sales_date_month_of_year\" as \"store_sales_date_month_of_year\",
    jay.\"store_sales_item_current_price\" as \"store_sales_item_current_price\",
    jackal.\"_virtual_6264207893106521\" as \"_virtual_6264207893106521\",
    jay.\"item_category\" as \"item_category\",
    jay.\"store_sales_customer_state\" as \"store_sales_customer_state\",
    jay.\"customer_count\" as \"customer_count\"
FROM
    jay
    LEFT OUTER JOIN jackal on ((jay.\"store_sales_customer_state\" is null and jackal.\"store_sales_customer_state\" is null) or (jay.\"store_sales_customer_state\" = jackal.\"store_sales_customer_state\")) AND ((jay.\"item_category\" is null and jackal.\"item_category\" is null) or (jay.\"item_category\" = jackal.\"item_category\")) AND ((jay.\"store_sales_item_current_price\" is null and jackal.\"store_sales_item_current_price\" is null) or (jay.\"store_sales_item_current_price\" = jackal.\"store_sales_item_current_price\")) AND jay.\"store_sales_date_month_of_year\" = jackal.\"store_sales_date_month_of_year\" AND jay.\"store_sales_date_year\" = jackal.\"store_sales_date_year\"
WHERE
    jay.\"store_sales_date_year\" = 2001 and jay.\"store_sales_date_month_of_year\" = 1 and jay.\"store_sales_item_current_price\" > 1.2 * jackal.\"_virtual_6264207893106521\" and jay.\"item_category\" is not null
)
SELECT
    rook.\"store_sales_customer_state\" as \"store_sales_customer_state\",
    rook.\"customer_count\" as \"customer_count\"
FROM
    rook
WHERE
    rook.\"customer_count\" >= 10 and rook.\"store_sales_date_year\" = 2001 and rook.\"store_sales_date_month_of_year\" = 1 and rook.\"store_sales_item_current_price\" > 1.2 * rook.\"_virtual_6264207893106521\" and rook.\"item_category\" is not null

GROUP BY 
    rook.\"customer_count\",
    rook.\"store_sales_customer_state\"
ORDER BY 
    rook.\"customer_count\" asc nulls first,
    rook.\"store_sales_customer_state\" asc nulls first"""
