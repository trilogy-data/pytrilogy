query_id = 6
parse_time = 5.268323
exec_time = 0.933097
comp_time = 0.140106
gen_length = 6821
generated_sql = """

WITH 
level as (
SELECT
    store_sales.\"SS_SOLD_DATE_SK\" as \"store_sales_date_id\",
    store_sales.\"SS_ITEM_SK\" as \"item_id\",
    store_sales.\"SS_CUSTOMER_SK\" as \"store_sales_customer_id\"
FROM
    memory.store_sales as store_sales
GROUP BY 
    store_sales.\"SS_SOLD_DATE_SK\",
    store_sales.\"SS_ITEM_SK\",
    store_sales.\"SS_CUSTOMER_SK\"),
round as (
SELECT
    customers.\"C_CURRENT_ADDR_SK\" as \"store_sales_customer_address_id\",
    customers.\"C_CUSTOMER_SK\" as \"store_sales_customer_id\",
    customer_address.\"CA_STATE\" as \"store_sales_customer_state\"
FROM
    memory.customer as customers
    INNER JOIN memory.customer_address as customer_address on customers.\"C_CURRENT_ADDR_SK\" = customer_address.\"CA_ADDRESS_SK\"),
crow as (
SELECT
    items.\"I_CURRENT_PRICE\" as \"store_sales_item_current_price\",
    items.\"I_ITEM_SK\" as \"item_id\"
FROM
    memory.item as items),
divergent as (
SELECT
    avg(items.\"I_CURRENT_PRICE\") as \"_virtual_6264207893106521\",
    items.\"I_CATEGORY\" as \"item_category\"
FROM
    memory.item as items
WHERE
    items.\"I_CATEGORY\" is not null

GROUP BY 
    items.\"I_CATEGORY\"),
busy as (
SELECT
    date.\"D_DATE_SK\" as \"store_sales_date_id\",
    level.\"item_id\" as \"item_id\",
    level.\"store_sales_customer_id\" as \"store_sales_customer_id\",
    date.\"D_MOY\" as \"store_sales_date_month_of_year\",
    cast(\"D_YEAR\" as int) as \"store_sales_date_year\"
FROM
    level
    INNER JOIN memory.date_dim as date on level.\"store_sales_date_id\" = date.\"D_DATE_SK\"
WHERE
    cast(\"D_YEAR\" as int) = 2001 and date.\"D_MOY\" = 1
),
obsolete as (
SELECT
    items.\"I_CATEGORY\" as \"item_category\",
    crow.\"store_sales_item_current_price\" as \"store_sales_item_current_price\",
    busy.\"store_sales_date_month_of_year\" as \"store_sales_date_month_of_year\",
    round.\"store_sales_customer_state\" as \"store_sales_customer_state\",
    busy.\"store_sales_date_year\" as \"store_sales_date_year\",
    round.\"store_sales_customer_id\" as \"store_sales_customer_id\"
FROM
    round
    INNER JOIN busy on round.\"store_sales_customer_id\" = busy.\"store_sales_customer_id\"
    INNER JOIN memory.item as items on busy.\"item_id\" = items.\"I_ITEM_SK\"
    INNER JOIN crow on busy.\"item_id\" = crow.\"item_id\"
WHERE
    busy.\"store_sales_date_year\" = 2001 and busy.\"store_sales_date_month_of_year\" = 1 and items.\"I_CATEGORY\" is not null
),
rhea as (
SELECT
    obsolete.\"item_category\" as \"item_category\",
    obsolete.\"store_sales_item_current_price\" as \"store_sales_item_current_price\",
    obsolete.\"store_sales_date_month_of_year\" as \"store_sales_date_month_of_year\",
    obsolete.\"store_sales_customer_state\" as \"store_sales_customer_state\",
    obsolete.\"store_sales_date_year\" as \"store_sales_date_year\",
    divergent.\"_virtual_6264207893106521\" as \"_virtual_6264207893106521\"
FROM
    obsolete
    INNER JOIN divergent on (obsolete.\"item_category\" = divergent.\"item_category\" or (obsolete.\"item_category\" is null and divergent.\"item_category\" is null))
WHERE
    obsolete.\"store_sales_date_year\" = 2001 and obsolete.\"store_sales_date_month_of_year\" = 1 and obsolete.\"store_sales_item_current_price\" > 1.2 * divergent.\"_virtual_6264207893106521\" and obsolete.\"item_category\" is not null
),
concerned as (
SELECT
    obsolete.\"store_sales_customer_id\" as \"store_sales_customer_id_filter_5640408687474034\",
    obsolete.\"store_sales_customer_state\" as \"store_sales_customer_state\"
FROM
    obsolete
    INNER JOIN divergent on (obsolete.\"item_category\" = divergent.\"item_category\" or (obsolete.\"item_category\" is null and divergent.\"item_category\" is null))
WHERE
    obsolete.\"store_sales_date_year\" = 2001 and obsolete.\"store_sales_date_month_of_year\" = 1 and obsolete.\"store_sales_item_current_price\" > 1.2 * divergent.\"_virtual_6264207893106521\" and obsolete.\"item_category\" is not null
),
nondescript as (
SELECT
    count(concerned.\"store_sales_customer_id_filter_5640408687474034\") as \"customer_count\",
    concerned.\"store_sales_customer_state\" as \"store_sales_customer_state\"
FROM
    concerned
GROUP BY 
    concerned.\"store_sales_customer_state\"),
puffin as (
SELECT
    obsolete.\"store_sales_customer_state\" as \"store_sales_customer_state\",
    obsolete.\"item_category\" as \"item_category\",
    obsolete.\"store_sales_item_current_price\" as \"store_sales_item_current_price\",
    obsolete.\"store_sales_date_month_of_year\" as \"store_sales_date_month_of_year\",
    obsolete.\"store_sales_date_year\" as \"store_sales_date_year\",
    nondescript.\"customer_count\" as \"customer_count\"
FROM
    obsolete
    INNER JOIN nondescript on (obsolete.\"store_sales_customer_state\" = nondescript.\"store_sales_customer_state\" or (obsolete.\"store_sales_customer_state\" is null and nondescript.\"store_sales_customer_state\" is null))
WHERE
    obsolete.\"store_sales_date_year\" = 2001 and obsolete.\"store_sales_date_month_of_year\" = 1 and obsolete.\"item_category\" is not null
),
cuckoo as (
SELECT
    puffin.\"store_sales_date_year\" as \"store_sales_date_year\",
    puffin.\"store_sales_date_month_of_year\" as \"store_sales_date_month_of_year\",
    puffin.\"store_sales_item_current_price\" as \"store_sales_item_current_price\",
    rhea.\"_virtual_6264207893106521\" as \"_virtual_6264207893106521\",
    puffin.\"item_category\" as \"item_category\",
    puffin.\"store_sales_customer_state\" as \"store_sales_customer_state\",
    puffin.\"customer_count\" as \"customer_count\"
FROM
    puffin
    INNER JOIN rhea on (puffin.\"store_sales_customer_state\" = rhea.\"store_sales_customer_state\" or (puffin.\"store_sales_customer_state\" is null and rhea.\"store_sales_customer_state\" is null)) AND (puffin.\"item_category\" = rhea.\"item_category\" or (puffin.\"item_category\" is null and rhea.\"item_category\" is null)) AND (puffin.\"store_sales_item_current_price\" = rhea.\"store_sales_item_current_price\" or (puffin.\"store_sales_item_current_price\" is null and rhea.\"store_sales_item_current_price\" is null)) AND puffin.\"store_sales_date_month_of_year\" = rhea.\"store_sales_date_month_of_year\" AND puffin.\"store_sales_date_year\" = rhea.\"store_sales_date_year\"
WHERE
    puffin.\"store_sales_date_year\" = 2001 and puffin.\"store_sales_date_month_of_year\" = 1 and puffin.\"store_sales_item_current_price\" > 1.2 * rhea.\"_virtual_6264207893106521\" and puffin.\"item_category\" is not null
)
SELECT
    cuckoo.\"store_sales_customer_state\" as \"store_sales_customer_state\",
    cuckoo.\"customer_count\" as \"customer_count\"
FROM
    cuckoo
WHERE
    cuckoo.\"customer_count\" >= 10 and cuckoo.\"store_sales_date_year\" = 2001 and cuckoo.\"store_sales_date_month_of_year\" = 1 and cuckoo.\"store_sales_item_current_price\" > 1.2 * cuckoo.\"_virtual_6264207893106521\" and cuckoo.\"item_category\" is not null

GROUP BY 
    cuckoo.\"store_sales_customer_state\",
    cuckoo.\"customer_count\"
ORDER BY 
    cuckoo.\"customer_count\" asc nulls first,
    cuckoo.\"store_sales_customer_state\" asc nulls first"""
