import std.geography;
import std.net;
import std.color;
import etl;

key code string;
property code.u_code string;
property code.state_code string;
property code.type string;
property code.class string;
property code.t_start string;
property code.t_stop string;
property code.short_name string;
property code.name string;
property code.location string;
property code.longitude float;
property code.latitude float;
property code.error float;
property code.parent string;
property code.short_e_name string;
property code._e_name string; #english name
property code.u_name string;
property flag <- CAST(CASE WHEN state_code in ('SU', 'RU') THEN 'https://upload.wikimedia.org/wikipedia/commons/5/53/Flag_of_the_Soviet_Union_%283-2%29.svg'
WHEN state_code = 'US' THEN 'https://upload.wikimedia.org/wikipedia/commons/5/55/Flag_of_the_United_States_%283-2_aspect_ratio%29.svg'
WHEN state_code = 'CN' THEN 'https://upload.wikimedia.org/wikipedia/commons/thumb/f/fa/Flag_of_the_People%27s_Republic_of_China.svg/2880px-Flag_of_the_People%27s_Republic_of_China.svg.png'
ELSE 'https://upload.wikimedia.org/wikipedia/commons/thumb/2/2f/Flag_of_the_United_Nations.svg/2880px-Flag_of_the_United_Nations.svg.png'
END AS string::url_image);

auto e_name <-coalesce(_e_name, u_name);



datasource organizations (
    code,
    u_code,
    state_code,
    type,
    class,
    t_start,
    t_stop,
    short_name,
    name,
    location,
    ?longitude,
    ?latitude,
    error,
    parent,
    short_e_name,
    ?_e_name,
    u_name,
    data_updated_through
    )
grain (code)
file `gcs://trilogy_public_models/duckdb/launch_report/organizations.parquet`
freshness by data_updated_through;
