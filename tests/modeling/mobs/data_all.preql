import genus as genus;

key column00 int; # unique identifier of samples in the row
property <column00>.Order_Added string;
property <column00>.valid_aphiaID string;
key phylum string;
key class string;
key orders string;
key family string;


key scientificName string;
property <column00>.scientificNameAuthorship string;
property <column00>.length_cm float;
property <column00>.diameter_width_cm string;
property <column00>.height_cm float;
property <column00>.notes string;
property <column00>.size_ref string;
property <column00>.date_added date;

auto sample_count<-count(column00);

auto  log_length_bin <- case  
        when length_cm < 1 then '0-1'  
        when length_cm < 10 then '1-10'  
        when length_cm < 100 then '10-100'  
        when length_cm < 1000 then '100-1000'  
        else '1000+'  
    end;

auto avg_genus_size <- avg(length_cm) by genus.name;
auto avg_class_size <- avg(length_cm) by class;
auto log_genus_size <- log(avg_genus_size);
auto log_class_size <- log(avg_class_size);
auto genus_size_bucket <- round(log_genus_size, 10);
auto class_size_bucket <- round(log_class_size, 10);

datasource data_all_112224 (
	column00,
	Order_Added,
	valid_aphiaID,
	phylum,
	class,
	order:orders,
	family,
	genus:genus.name,
	scientificName,
	scientificNameAuthorship,
	length_cm:length_cm,
	diameter_width_cm,
	height_cm:height_cm,
	notes,
	size_ref,
	date_added
)
grain (column00)
address data_all_112224;


